"81b3f8ed6e6a7c87ad032fa7399945999af64953"
[cl-struct-undo-tree [nil ([nil ([nil (#1=[nil nil (("
" . 1) (undo-tree-id0 . 1) (undo-tree-id1 . 1)) nil (21640 24092 234747 913000) 0 nil]) ((#("
###############
#LIBS
###############
library(lme4)
library(reshape)
library(foreign) 
library(ggplot2)
library(plyr)
library(data.table)
library(reshape2)
library(Hmisc)
library(mgcv)
library(gdata)
library(car)
library(dplyr)
library(ggmap)
library(broom)
library(splines)
#sourcing
source(\"/media/NAS/Uni/org/files/Uni/Projects/code/$Rsnips/CV_splits.r\")
source(\"/media/NAS/Uni/org/files/Uni/Projects/code/$Rsnips/rmspe.r\")


#-------------------->> RES TABLE
res <- matrix(nrow=9, ncol=45)
res <- data.frame(res)
colnames(res) <- c(
          \"year\"
          ,\"m1.R2\",\"m1.PE\",\"m1.R2.s\",\"m1.R2.t\",\"m1.PE.s\" #full model
          ,\"m1cv.R2\",\"m1cv.I\",\"m1cv.I.se\",\"m1cv.S\",\"m1cv.S.se\",\"m1cv.PE\",\"m1cv.R2.s\",\"m1cv.R2.t\",\"m1cv.PE.s\" #mod1 CV
          ,\"m1cv.loc.R2\",\"m1cv.loc.I\",\"m1cv.loc.I.se\",\"m1cv.loc.S\",\"m1cv.loc.S.se\",\"m1cv.loc.PE\",\"m1cv.loc.PE.s\",\"m1cv.loc.R2.s\",\"m1cv.loc.R2.t\"#loc m1
          ,\"mod2_R2\" #mod2
          ,\"m3.t31\",\"m3.t33\" #mod3 tests
          ,\"mod3_pm_mod3\",\"mod3_int\"
          ,\"mod3_int_SE\",\"mod3_Slope\",\"mod3_Slope SE\",\"mod3_RMSPE\"
          ,\"mod3_spatial\",\"mod3_temporal\",\"mod3_RMSPE_spatial\",
          \"mod3LPM_pm_mod3LPM\",\"mod3LPM_int\",\"mod3LPM_int_SE\",\"mod3LPM_Slope\",
                   \"mod3LPM_Slope SE\",\"mod3LPM_RMSPE\",\"mod3LPM_spatial\",\"mod3LPM_temporal\",\"mod3LPM_RMSPE_spatial\"
                   )
res$year <- c(2003:2011); 



### import data
m1.2000 <-readRDS(\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/mod1.AQ.2000.rds\")

### subset to aqua and apply alexei cleaning methods
m1.2000<-m1.2000[MaskAdjacency == \"000\" & UN > 0 & UN < 0.04] 

################# clean BAD STN PM25 and check if improved model?
rawdf <- ddply(m1.2000, c( \"stn\"), 
      function(x) {
        mod1 <- lm(PM25 ~ aod, data=x)
        data.frame(R2 = round(summary(mod1)$r.squared, 5), 
                   nsamps = length(summary(mod1)$resid))
})
rawdf
rawdf<-as.data.table(rawdf)
bad<- rawdf[R2< 0.05]
bad[,badid := paste(stn,sep=\"-\")]
#################BAD STN
m1.2000[,badid := paste(stn,sep=\"-\")]
####Take out bad stations
m1.2000 <- m1.2000[!(m1.2000$badid %in% bad$badid), ] 

#check it does better
m1.formula <- as.formula(PM25~ aod+(1+aod|day))
x<-  lmer(m1.formula,data=m1.2000)
m1.2000$predicted <- predict(x)
glance(lm(PM25~predicted,data=m1.2000))#0.74
#get rid of missing
m1.2000 <- na.omit(m1.2000)
m1.2000[,elev.s:= scale(elev)]
m1.2000[,tden.s:= scale(tden)]
m1.2000[,pden.s:= scale(pden)]
m1.2000[,dist2A1.s:= scale(dist2A1)]
m1.2000[,dist2water.s:= scale(dist2water)]
m1.2000[,dist2rail.s:= scale(dist2rail)]
m1.2000[,Dist2road.s:= scale(Dist2road)]
m1.2000[,ndvi.s:= scale(ndvi)]
m1.2000[,MeanPbl.s:= scale(MeanPbl)]
m1.2000[,p_ind.s:= scale(p_ind)]
m1.2000[,p_for.s:= scale(p_for)]
m1.2000[,p_farm.s:= scale(p_farm)]
m1.2000[,p_dos.s:= scale(p_dos)]
m1.2000[,p_dev.s:= scale(p_dev)]
m1.2000[,p_os.s:= scale(p_os)]
m1.2000[,Temp.s:= scale(Temp)]
m1.2000[,WD.s:= scale(WD)]
m1.2000[,WS.s:= scale(WS)]
m1.2000[,RH.s:= scale(RH)]
m1.2000[,Rain.s:= scale(Rain)]



m1.formula <- as.formula(PM25~ aod
                        +Temp.s+WD.s+RH.s+WS.s+Dust+Rain.s+MeanPbl.s #temporal
                        +elev.s+tden.s+pden.s+Dist2road.s+ndvi.s #spatial
                        +p_os.s #+p_dev.s+p_dos.s+p_farm.s+p_for.s+p_ind.s  #land use
                         #+aod*Dust #interactions
                         +(1+aod|day/reg_num)+(1|stn)) #0.812

#full fit
m1.fit.2000 <-  lmer(m1.formula,data=m1.2000,weights=normwt)
m1.2000$pred.m1 <- predict(m1.fit.2000)
res[res$year==\"2000\", 'm1.R2'] <- print(summary(lm(PM25~pred.m1,data=m1.2000))$r.squared)
#RMSPE
res[res$year==\"2000\", 'm1.PE'] <- print(rmse(residuals(m1.fit.2000)))

#spatial
###to check
spatial2000<-m1.2000 %>%
    group_by(stn) %>%
    summarise(barpm = mean(PM25, na.rm=TRUE), barpred = mean(pred.m1, na.rm=TRUE)) 
m1.fit.2000.spat<- lm(barpm ~ barpred, data=spatial2000)
res[res$year==\"2000\", 'm1.R2.s'] <-  print(summary(lm(barpm ~ barpred, data=spatial2000))$r.squared)
res[res$year==\"2000\", 'm1.PE.s'] <- print(rmse(residuals(m1.fit.2000.spat)))
       
#temporal
tempo2000<-left_join(m1.2000,spatial2000)
tempo2000$delpm <-tempo2000$PM25-tempo2000$barpm
tempo2000$delpred <-tempo2000$pred.m1-tempo2000$barpred
mod_temporal <- lm(delpm ~ delpred, data=tempo2000)
res[res$year==\"2000\", 'm1.R2.t'] <-  print(summary(lm(delpm ~ delpred, data=tempo2000))$r.squared)
saveRDS(m1.2000,\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/mod1.AQ.2000.pred.rds\")


#---------------->>>> CV
#s1
splits_s1 <- splitdf(m1.2000)
test_s1 <- splits_s1$testset
train_s1 <- splits_s1$trainset
out_train_s1 <- lmer(m1.formula,data =  train_s1,weights=normwt)
test_s1$pred.m1.cv <- predict(object=out_train_s1 ,newdata=test_s1,allow.new.levels=TRUE,re.form=NULL )
test_s1$iter<-\"s1\"
#s2
splits_s2 <- splitdf(m1.2000)
test_s2 <- splits_s2$testset
train_s2 <- splits_s2$trainset
out_train_s2 <- lmer(m1.formula,data =  train_s2,weights=normwt)
test_s2$pred.m1.cv <- predict(object=out_train_s2 ,newdata=test_s2,allow.new.levels=TRUE,re.form=NULL )
test_s2$iter<-\"s2\"
#s3
splits_s3 <- splitdf(m1.2000)
test_s3 <- splits_s3$testset
train_s3 <- splits_s3$trainset
out_train_s3 <- lmer(m1.formula,data =  train_s3,weights=normwt)
test_s3$pred.m1.cv <- predict(object=out_train_s3 ,newdata=test_s3,allow.new.levels=TRUE,re.form=NULL )
test_s3$iter<-\"s3\"
#s4
splits_s4 <- splitdf(m1.2000)
test_s4 <- splits_s4$testset
train_s4 <- splits_s4$trainset
out_train_s4 <- lmer(m1.formula,data =  train_s4,weights=normwt)
test_s4$pred.m1.cv <- predict(object=out_train_s4 ,newdata=test_s4,allow.new.levels=TRUE,re.form=NULL )
test_s4$iter<-\"s4\"
#s5
splits_s5 <- splitdf(m1.2000)
test_s5 <- splits_s5$testset
train_s5 <- splits_s5$trainset
out_train_s5 <- lmer(m1.formula,data =  train_s5,weights=normwt)
test_s5$pred.m1.cv <- predict(object=out_train_s5 ,newdata=test_s5,allow.new.levels=TRUE,re.form=NULL )
test_s5$iter<-\"s5\"
#s6
splits_s6 <- splitdf(m1.2000)
test_s6 <- splits_s6$testset
train_s6 <- splits_s6$trainset
out_train_s6 <- lmer(m1.formula,data =  train_s6,weights=normwt)
test_s6$pred.m1.cv <- predict(object=out_train_s6 ,newdata=test_s6,allow.new.levels=TRUE,re.form=NULL )
test_s6$iter<-\"s6\"
#s7
splits_s7 <- splitdf(m1.2000)
test_s7 <- splits_s7$testset
train_s7 <- splits_s7$trainset
out_train_s7 <- lmer(m1.formula,data =  train_s7,weights=normwt)
test_s7$pred.m1.cv <- predict(object=out_train_s7 ,newdata=test_s7,allow.new.levels=TRUE,re.form=NULL )
test_s7$iter<-\"s7\"
#s8
splits_s8 <- splitdf(m1.2000)
test_s8 <- splits_s8$testset
train_s8 <- splits_s8$trainset
out_train_s8 <- lmer(m1.formula,data =  train_s8,weights=normwt)
test_s8$pred.m1.cv <- predict(object=out_train_s8 ,newdata=test_s8,allow.new.levels=TRUE,re.form=NULL )
test_s8$iter<-\"s8\"
#s9
splits_s9 <- splitdf(m1.2000)
test_s9 <- splits_s9$testset
train_s9 <- splits_s9$trainset
out_train_s9 <- lmer(m1.formula,data =  train_s9,weights=normwt)
test_s9$pred.m1.cv <- predict(object=out_train_s9 ,newdata=test_s9,allow.new.levels=TRUE,re.form=NULL )
test_s9$iter<-\"s9\"
#s10
splits_s10 <- splitdf(m1.2000)
test_s10 <- splits_s10$testset
train_s10 <- splits_s10$trainset
out_train_s10 <- lmer(m1.formula,data =  train_s10,weights=normwt)
test_s10$pred.m1.cv <- predict(object=out_train_s10 ,newdata=test_s10,allow.new.levels=TRUE,re.form=NULL )
test_s10$iter<-\"s10\"

#BIND 1 dataset
m1.2000.cv<- data.table(rbind(test_s1,test_s2,test_s3,test_s4,test_s5,test_s6,test_s7,test_s8,test_s9, test_s10))
# cleanup (remove from WS) objects from CV
rm(list = ls(pattern = \"train_|test_\"))
#table updates
m1.fit.2000.cv<-lm(PM25~pred.m1.cv,data=m1.2000.cv)
res[res$year==\"2000\", 'm1cv.R2'] <- print(summary(lm(PM25~pred.m1.cv,data=m1.2000.cv))$r.squared)
res[res$year==\"2000\", 'm1cv.I'] <-print(summary(lm(PM25~pred.m1.cv,data=m1.2000.cv))$coef[1,1])
res[res$year==\"2000\", 'm1cv.I.se'] <-print(summary(lm(PM25~pred.m1.cv,data=m1.2000.cv))$coef[1,2])
res[res$year==\"2000\", 'm1cv.S'] <-print(summary(lm(PM25~pred.m1.cv,data=m1.2000.cv))$coef[2,1])
res[res$year==\"2000\", 'm1cv.S.se'] <-print(summary(lm(PM25~pred.m1.cv,data=m1.2000.cv))$coef[2,2])
#RMSPE
res[res$year==\"2000\", 'm1cv.PE'] <- print(rmse(residuals(m1.fit.2000.cv)))

#spatial
spatial2000.cv<-m1.2000.cv %>%
    group_by(stn) %>%
    summarise(barpm = mean(PM25, na.rm=TRUE), barpred = mean(pred.m1, na.rm=TRUE)) 
m1.fit.2000.cv.s <- lm(barpm ~ barpred, data=spatial2000.cv)
res[res$year==\"2000\", 'm1cv.R2.s'] <-  print(summary(lm(barpm ~ barpred, data=spatial2000.cv))$r.squared)
res[res$year==\"2000\", 'm1cv.PE.s'] <- print(rmse(residuals(m1.fit.2000.cv.s)))
       
#temporal
tempo2000.cv<-left_join(m1.2000.cv,spatial2000.cv)
tempo2000.cv$delpm <-tempo2000.cv$PM25-tempo2000.cv$barpm
tempo2000.cv$delpred <-tempo2000.cv$pred.m1.cv-tempo2000.cv$barpred
mod_temporal.cv <- lm(delpm ~ delpred, data=tempo2000.cv)
res[res$year==\"2000\", 'm1cv.R2.t'] <-  print(summary(lm(delpm ~ delpred, data=tempo2000.cv))$r.squared)



#-------->>> loc stage
luf<-fread(\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN004_LU_full_dataset/local.csv\")
setnames(luf,\"tden\",\"loc.tden\")
setnames(luf,\"elev50\",\"loc.elev\")

#add 50m LU to CV data
setkey(m1.2000.cv,stn)
setkey(luf,stn)
m1.2000.cv.loc <- merge(m1.2000.cv, luf, all.x = T)
m1.2000.cv.loc<-na.omit(m1.2000.cv.loc)

#create residual mp3 variable
m1.2000.cv.loc$res.m1<-m1.2000.cv.loc$PM25-m1.2000.cv.loc$pred.m1.cv

#The GAM model
gam.out<-gam(res.m1~s(loc.tden)+s(tden,MeanPbl)+s(loc.tden,WS)+s(loc_p_os,fx=FALSE,k=4,bs='cr')+s(loc.elev,fx=FALSE,k=4,bs='cr')+s(dA1,fx=FALSE,k=4,bs='cr')+s(dsea,fx=FALSE,k=4,bs='cr'),data=m1.2000.cv.loc)
#plot(bp.model.ps)
#summary(bp.model.ps)
## reg
m1.2000.cv.loc$pred.m1.loc <-predict(gam.out)
m1.2000.cv.loc$pred.m1.both <- m1.2000.cv.loc$pred.m1.cv + m1.2000.cv.loc$pred.m1.loc
res[res$year==\"2000\", 'm1cv.loc.R2'] <- print(summary(lm(PM25~pred.m1.both,data=m1.2000.cv.loc))$r.squared)
res[res$year==\"2000\", 'm1cv.loc.I'] <-print(summary(lm(PM25~pred.m1.both,data=m1.2000.cv.loc))$coef[1,1])
res[res$year==\"2000\", 'm1cv.loc.I.se'] <-print(summary(lm(PM25~pred.m1.both,data=m1.2000.cv.loc))$coef[1,2])
res[res$year==\"2000\", 'm1cv.loc.S'] <-print(summary(lm(PM25~pred.m1.both,data=m1.2000.cv.loc))$coef[2,1])
res[res$year==\"2000\", 'm1cv.loc.S.se'] <-print(summary(lm(PM25~pred.m1.both,data=m1.2000.cv.loc))$coef[2,2])
#RMSPE
res[res$year==\"2000\", 'm1cv.loc.PE'] <- print(rmse(residuals(m1.fit.2000.cv)))

#spatial
spatial2000.cv.loc<-m1.2000.cv.loc %>%
    group_by(stn) %>%
    summarise(barpm = mean(PM25, na.rm=TRUE), barpred = mean(pred.m1, na.rm=TRUE)) 
m1.fit.2000.cv.loc.s <- lm(barpm ~ barpred, data=spatial2000.cv.loc)
res[res$year==\"2000\", 'm1cv.loc.R2.s'] <-  print(summary(lm(barpm ~ barpred, data=spatial2000.cv.loc))$r.squared)
res[res$year==\"2000\", 'm1cv.loc.PE.s'] <- print(rmse(residuals(m1.fit.2000.cv.loc.s)))
       
#temporal
tempo2000.loc.cv<-left_join(m1.2000.cv.loc,spatial2000.cv.loc)
tempo2000.loc.cv$delpm <-tempo2000.loc.cv$PM25-tempo2000.loc.cv$barpm
tempo2000.loc.cv$delpred <-tempo2000.loc.cv$pred.m1.both-tempo2000.loc.cv$barpred
mod_temporal.loc.cv <- lm(delpm ~ delpred, data=tempo2000.loc.cv)
res[res$year==\"2000\", 'm1cv.loc.R2.t'] <-  print(summary(lm(delpm ~ delpred, data=tempo2000.loc.cv))$r.squared)

#############save midpoint
saveRDS(res, \"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/res2000.m1.rds\")
saveRDS(res, \"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/resALL.rds\")
saveRDS(m1.2000.cv.loc,\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/mod1.AQ.2000.predCV.rds\")


###############
#MOD2
###############
m2.2000<-readRDS(\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/mod2.AQ.2000.rds\")


m2.2000[,elev.s:= scale(elev)]
m2.2000[,tden.s:= scale(tden)]
m2.2000[,pden.s:= scale(pden)]
m2.2000[,dist2A1.s:= scale(dist2A1)]
m2.2000[,dist2water.s:= scale(dist2water)]
m2.2000[,dist2rail.s:= scale(dist2rail)]
m2.2000[,Dist2road.s:= scale(Dist2road)]
m2.2000[,ndvi.s:= scale(ndvi)]
m2.2000[,MeanPbl.s:= scale(MeanPbl)]
m2.2000[,p_ind.s:= scale(p_ind)]
m2.2000[,p_for.s:= scale(p_for)]
m2.2000[,p_farm.s:= scale(p_farm)]
m2.2000[,p_dos.s:= scale(p_dos)]
m2.2000[,p_dev.s:= scale(p_dev)]
m2.2000[,p_os.s:= scale(p_os)]
m2.2000[,Temp.s:= scale(Temp)]
m2.2000[,WD.s:= scale(WD)]
m2.2000[,WS.s:= scale(WS)]
m2.2000[,RH.s:= scale(RH)]
m2.2000[,Rain.s:= scale(Rain)]

#generate predictions
m2.2000[, pred.m2 := predict(object=m1.fit.2000,newdata=m2.2000,allow.new.levels=TRUE,re.form=NULL)]
describe(m2.2000$pred.m2)
#delete implossible values
m2.2000 <- m2.2000[pred.m2 > 0.00000000000001 , ]
m2.2000 <- m2.2000[pred.m2 < 500   , ]

saveRDS(m2.2000,\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/mod2.AQ.2000.rds\")

#test
# describe(m2.2000$pred.m2)
# hist(m2.2000$pred.m2)

#######
#M2 R2
######
# m1.2000[,aodid:= paste(m1.2000$long_aod,m1.2000$lat_aod,sep=\"-\")]
# #merge co located mod1 and mod2 grids
# setkey(m1.2000,aodid,day)
# setkey(m2.2000,aodid,day)
# m.1.2.pred <- merge(m1.2000, m2.2000[, list(aodid, day, pred.m2)], all.x = T)
# mod2_reg<-lm(m.1.2.pred$predicted~m.1.2.pred$pred.m2)
# #cleanup and save current stages (workspace)
# summary(mod2_reg)$r.squared

#map the predictions
#aggregate by guid
m2_agg <- m2.2000[, list(LTPM.m2 = mean(pred.m2, na.rm = TRUE), lat_aod = lat_aod[1], long_aod = long_aod[1]), by = aodid]
#saveRDS(m2_agg, \"/media/NAS/Uni/Projects/P046.Israel_MAIAC/3.Work/2.Gather_data/FN008_model_prep/m2_agg_2000.rds\")
#map the predictions
write.csv(m2_agg, \"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/m2.2000.LTPM.csv\")
ggplot(m2_agg, aes(long_aod,lat_aod, color = LTPM.m2)) + 
  geom_point(size = 3, shape = 15) +  xlab(\"longitude\") + ylab(\"latitude\") + 
  scale_colour_gradientn(\"long term PM2.5 prediction\", colours = rainbow(5)) + theme_bw() + ggtitle(\"Long term predictions\")
ggsave(file=\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/LTPM.2000.m2.png\")
keep(res , sure=TRUE) 
gc()




###############
#LIBS
###############
library(lme4)
library(reshape)
library(foreign) 
library(ggplot2)
library(plyr)
library(data.table)
library(reshape2)
library(Hmisc)
library(mgcv)
library(gdata)
library(car)
library(dplyr)
library(ggmap)
library(broom)
library(splines)
#sourcing
source(\"/media/NAS/Uni/org/files/Uni/Projects/code/$Rsnips/CV_splits.r\")
source(\"/media/NAS/Uni/org/files/Uni/Projects/code/$Rsnips/rmspe.r\")


#-------------------->> RES TABLE
res <- matrix(nrow=9, ncol=45)
res <- data.frame(res)
colnames(res) <- c(
          \"year\"
          ,\"m1.R2\",\"m1.PE\",\"m1.R2.s\",\"m1.R2.t\",\"m1.PE.s\" #full model
          ,\"m1cv.R2\",\"m1cv.I\",\"m1cv.I.se\",\"m1cv.S\",\"m1cv.S.se\",\"m1cv.PE\",\"m1cv.R2.s\",\"m1cv.R2.t\",\"m1cv.PE.s\" #mod1 CV
          ,\"m1cv.loc.R2\",\"m1cv.loc.I\",\"m1cv.loc.I.se\",\"m1cv.loc.S\",\"m1cv.loc.S.se\",\"m1cv.loc.PE\",\"m1cv.loc.PE.s\",\"m1cv.loc.R2.s\",\"m1cv.loc.R2.t\"#loc m1
          ,\"mod2_R2\" #mod2
          ,\"m3.t31\",\"m3.t33\" #mod3 tests
          ,\"mod3_pm_mod3\",\"mod3_int\"
          ,\"mod3_int_SE\",\"mod3_Slope\",\"mod3_Slope SE\",\"mod3_RMSPE\"
          ,\"mod3_spatial\",\"mod3_temporal\",\"mod3_RMSPE_spatial\",
          \"mod3LPM_pm_mod3LPM\",\"mod3LPM_int\",\"mod3LPM_int_SE\",\"mod3LPM_Slope\",
                   \"mod3LPM_Slope SE\",\"mod3LPM_RMSPE\",\"mod3LPM_spatial\",\"mod3LPM_temporal\",\"mod3LPM_RMSPE_spatial\"
                   )
res$year <- c(2003:2011); 



### import data
m1.2001 <-readRDS(\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/mod1.AQ.2001.rds\")

### subset to aqua and apply alexei cleaning methods
m1.2001<-m1.2001[MaskAdjacency == \"000\" & UN > 0 & UN < 0.04] 

################# clean BAD STN PM25 and check if improved model?
rawdf <- ddply(m1.2001, c( \"stn\"), 
      function(x) {
        mod1 <- lm(PM25 ~ aod, data=x)
        data.frame(R2 = round(summary(mod1)$r.squared, 5), 
                   nsamps = length(summary(mod1)$resid))
})
rawdf
rawdf<-as.data.table(rawdf)
bad<- rawdf[R2< 0.05]
bad[,badid := paste(stn,sep=\"-\")]
#################BAD STN
m1.2001[,badid := paste(stn,sep=\"-\")]
####Take out bad stations
m1.2001 <- m1.2001[!(m1.2001$badid %in% bad$badid), ] 

#check it does better
m1.formula <- as.formula(PM25~ aod+(1+aod|day))
x<-  lmer(m1.formula,data=m1.2001)
m1.2001$predicted <- predict(x)
glance(lm(PM25~predicted,data=m1.2001))#0.74
#get rid of missing
m1.2001 <- na.omit(m1.2001)
m1.2001[,elev.s:= scale(elev)]
m1.2001[,tden.s:= scale(tden)]
m1.2001[,pden.s:= scale(pden)]
m1.2001[,dist2A1.s:= scale(dist2A1)]
m1.2001[,dist2water.s:= scale(dist2water)]
m1.2001[,dist2rail.s:= scale(dist2rail)]
m1.2001[,Dist2road.s:= scale(Dist2road)]
m1.2001[,ndvi.s:= scale(ndvi)]
m1.2001[,MeanPbl.s:= scale(MeanPbl)]
m1.2001[,p_ind.s:= scale(p_ind)]
m1.2001[,p_for.s:= scale(p_for)]
m1.2001[,p_farm.s:= scale(p_farm)]
m1.2001[,p_dos.s:= scale(p_dos)]
m1.2001[,p_dev.s:= scale(p_dev)]
m1.2001[,p_os.s:= scale(p_os)]
m1.2001[,Temp.s:= scale(Temp)]
m1.2001[,WD.s:= scale(WD)]
m1.2001[,WS.s:= scale(WS)]
m1.2001[,RH.s:= scale(RH)]
m1.2001[,Rain.s:= scale(Rain)]



m1.formula <- as.formula(PM25~ aod
                        +Temp.s+WD.s+RH.s+WS.s+Dust+Rain.s+MeanPbl.s #temporal
                        +elev.s+tden.s+pden.s+Dist2road.s+ndvi.s #spatial
                        +p_os.s #+p_dev.s+p_dos.s+p_farm.s+p_for.s+p_ind.s  #land use
                         #+aod*Dust #interactions
                         +(1+aod|day/reg_num)+(1|stn)) #0.812

#full fit
m1.fit.2001 <-  lmer(m1.formula,data=m1.2001,weights=normwt)
m1.2001$pred.m1 <- predict(m1.fit.2001)
res[res$year==\"2001\", 'm1.R2'] <- print(summary(lm(PM25~pred.m1,data=m1.2001))$r.squared)
#RMSPE
res[res$year==\"2001\", 'm1.PE'] <- print(rmse(residuals(m1.fit.2001)))

#spatial
###to check
spatial2001<-m1.2001 %>%
    group_by(stn) %>%
    summarise(barpm = mean(PM25, na.rm=TRUE), barpred = mean(pred.m1, na.rm=TRUE)) 
m1.fit.2001.spat<- lm(barpm ~ barpred, data=spatial2001)
res[res$year==\"2001\", 'm1.R2.s'] <-  print(summary(lm(barpm ~ barpred, data=spatial2001))$r.squared)
res[res$year==\"2001\", 'm1.PE.s'] <- print(rmse(residuals(m1.fit.2001.spat)))
       
#temporal
tempo2001<-left_join(m1.2001,spatial2001)
tempo2001$delpm <-tempo2001$PM25-tempo2001$barpm
tempo2001$delpred <-tempo2001$pred.m1-tempo2001$barpred
mod_temporal <- lm(delpm ~ delpred, data=tempo2001)
res[res$year==\"2001\", 'm1.R2.t'] <-  print(summary(lm(delpm ~ delpred, data=tempo2001))$r.squared)
saveRDS(m1.2001,\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/mod1.AQ.2001.pred.rds\")


#---------------->>>> CV
#s1
splits_s1 <- splitdf(m1.2001)
test_s1 <- splits_s1$testset
train_s1 <- splits_s1$trainset
out_train_s1 <- lmer(m1.formula,data =  train_s1,weights=normwt)
test_s1$pred.m1.cv <- predict(object=out_train_s1 ,newdata=test_s1,allow.new.levels=TRUE,re.form=NULL )
test_s1$iter<-\"s1\"
#s2
splits_s2 <- splitdf(m1.2001)
test_s2 <- splits_s2$testset
train_s2 <- splits_s2$trainset
out_train_s2 <- lmer(m1.formula,data =  train_s2,weights=normwt)
test_s2$pred.m1.cv <- predict(object=out_train_s2 ,newdata=test_s2,allow.new.levels=TRUE,re.form=NULL )
test_s2$iter<-\"s2\"
#s3
splits_s3 <- splitdf(m1.2001)
test_s3 <- splits_s3$testset
train_s3 <- splits_s3$trainset
out_train_s3 <- lmer(m1.formula,data =  train_s3,weights=normwt)
test_s3$pred.m1.cv <- predict(object=out_train_s3 ,newdata=test_s3,allow.new.levels=TRUE,re.form=NULL )
test_s3$iter<-\"s3\"
#s4
splits_s4 <- splitdf(m1.2001)
test_s4 <- splits_s4$testset
train_s4 <- splits_s4$trainset
out_train_s4 <- lmer(m1.formula,data =  train_s4,weights=normwt)
test_s4$pred.m1.cv <- predict(object=out_train_s4 ,newdata=test_s4,allow.new.levels=TRUE,re.form=NULL )
test_s4$iter<-\"s4\"
#s5
splits_s5 <- splitdf(m1.2001)
test_s5 <- splits_s5$testset
train_s5 <- splits_s5$trainset
out_train_s5 <- lmer(m1.formula,data =  train_s5,weights=normwt)
test_s5$pred.m1.cv <- predict(object=out_train_s5 ,newdata=test_s5,allow.new.levels=TRUE,re.form=NULL )
test_s5$iter<-\"s5\"
#s6
splits_s6 <- splitdf(m1.2001)
test_s6 <- splits_s6$testset
train_s6 <- splits_s6$trainset
out_train_s6 <- lmer(m1.formula,data =  train_s6,weights=normwt)
test_s6$pred.m1.cv <- predict(object=out_train_s6 ,newdata=test_s6,allow.new.levels=TRUE,re.form=NULL )
test_s6$iter<-\"s6\"
#s7
splits_s7 <- splitdf(m1.2001)
test_s7 <- splits_s7$testset
train_s7 <- splits_s7$trainset
out_train_s7 <- lmer(m1.formula,data =  train_s7,weights=normwt)
test_s7$pred.m1.cv <- predict(object=out_train_s7 ,newdata=test_s7,allow.new.levels=TRUE,re.form=NULL )
test_s7$iter<-\"s7\"
#s8
splits_s8 <- splitdf(m1.2001)
test_s8 <- splits_s8$testset
train_s8 <- splits_s8$trainset
out_train_s8 <- lmer(m1.formula,data =  train_s8,weights=normwt)
test_s8$pred.m1.cv <- predict(object=out_train_s8 ,newdata=test_s8,allow.new.levels=TRUE,re.form=NULL )
test_s8$iter<-\"s8\"
#s9
splits_s9 <- splitdf(m1.2001)
test_s9 <- splits_s9$testset
train_s9 <- splits_s9$trainset
out_train_s9 <- lmer(m1.formula,data =  train_s9,weights=normwt)
test_s9$pred.m1.cv <- predict(object=out_train_s9 ,newdata=test_s9,allow.new.levels=TRUE,re.form=NULL )
test_s9$iter<-\"s9\"
#s10
splits_s10 <- splitdf(m1.2001)
test_s10 <- splits_s10$testset
train_s10 <- splits_s10$trainset
out_train_s10 <- lmer(m1.formula,data =  train_s10,weights=normwt)
test_s10$pred.m1.cv <- predict(object=out_train_s10 ,newdata=test_s10,allow.new.levels=TRUE,re.form=NULL )
test_s10$iter<-\"s10\"

#BIND 1 dataset
m1.2001.cv<- data.table(rbind(test_s1,test_s2,test_s3,test_s4,test_s5,test_s6,test_s7,test_s8,test_s9, test_s10))
# cleanup (remove from WS) objects from CV
rm(list = ls(pattern = \"train_|test_\"))
#table updates
m1.fit.2001.cv<-lm(PM25~pred.m1.cv,data=m1.2001.cv)
res[res$year==\"2001\", 'm1cv.R2'] <- print(summary(lm(PM25~pred.m1.cv,data=m1.2001.cv))$r.squared)
res[res$year==\"2001\", 'm1cv.I'] <-print(summary(lm(PM25~pred.m1.cv,data=m1.2001.cv))$coef[1,1])
res[res$year==\"2001\", 'm1cv.I.se'] <-print(summary(lm(PM25~pred.m1.cv,data=m1.2001.cv))$coef[1,2])
res[res$year==\"2001\", 'm1cv.S'] <-print(summary(lm(PM25~pred.m1.cv,data=m1.2001.cv))$coef[2,1])
res[res$year==\"2001\", 'm1cv.S.se'] <-print(summary(lm(PM25~pred.m1.cv,data=m1.2001.cv))$coef[2,2])
#RMSPE
res[res$year==\"2001\", 'm1cv.PE'] <- print(rmse(residuals(m1.fit.2001.cv)))

#spatial
spatial2001.cv<-m1.2001.cv %>%
    group_by(stn) %>%
    summarise(barpm = mean(PM25, na.rm=TRUE), barpred = mean(pred.m1, na.rm=TRUE)) 
m1.fit.2001.cv.s <- lm(barpm ~ barpred, data=spatial2001.cv)
res[res$year==\"2001\", 'm1cv.R2.s'] <-  print(summary(lm(barpm ~ barpred, data=spatial2001.cv))$r.squared)
res[res$year==\"2001\", 'm1cv.PE.s'] <- print(rmse(residuals(m1.fit.2001.cv.s)))
       
#temporal
tempo2001.cv<-left_join(m1.2001.cv,spatial2001.cv)
tempo2001.cv$delpm <-tempo2001.cv$PM25-tempo2001.cv$barpm
tempo2001.cv$delpred <-tempo2001.cv$pred.m1.cv-tempo2001.cv$barpred
mod_temporal.cv <- lm(delpm ~ delpred, data=tempo2001.cv)
res[res$year==\"2001\", 'm1cv.R2.t'] <-  print(summary(lm(delpm ~ delpred, data=tempo2001.cv))$r.squared)



#-------->>> loc stage
luf<-fread(\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN004_LU_full_dataset/local.csv\")
setnames(luf,\"tden\",\"loc.tden\")
setnames(luf,\"elev50\",\"loc.elev\")

#add 50m LU to CV data
setkey(m1.2001.cv,stn)
setkey(luf,stn)
m1.2001.cv.loc <- merge(m1.2001.cv, luf, all.x = T)
m1.2001.cv.loc<-na.omit(m1.2001.cv.loc)

#create residual mp3 variable
m1.2001.cv.loc$res.m1<-m1.2001.cv.loc$PM25-m1.2001.cv.loc$pred.m1.cv

#The GAM model
gam.out<-gam(res.m1~s(loc.tden)+s(tden,MeanPbl)+s(loc.tden,WS)+s(loc_p_os,fx=FALSE,k=4,bs='cr')+s(loc.elev,fx=FALSE,k=4,bs='cr')+s(dA1,fx=FALSE,k=4,bs='cr')+s(dsea,fx=FALSE,k=4,bs='cr'),data=m1.2001.cv.loc)
#plot(bp.model.ps)
#summary(bp.model.ps)
## reg
m1.2001.cv.loc$pred.m1.loc <-predict(gam.out)
m1.2001.cv.loc$pred.m1.both <- m1.2001.cv.loc$pred.m1.cv + m1.2001.cv.loc$pred.m1.loc
res[res$year==\"2001\", 'm1cv.loc.R2'] <- print(summary(lm(PM25~pred.m1.both,data=m1.2001.cv.loc))$r.squared)
res[res$year==\"2001\", 'm1cv.loc.I'] <-print(summary(lm(PM25~pred.m1.both,data=m1.2001.cv.loc))$coef[1,1])
res[res$year==\"2001\", 'm1cv.loc.I.se'] <-print(summary(lm(PM25~pred.m1.both,data=m1.2001.cv.loc))$coef[1,2])
res[res$year==\"2001\", 'm1cv.loc.S'] <-print(summary(lm(PM25~pred.m1.both,data=m1.2001.cv.loc))$coef[2,1])
res[res$year==\"2001\", 'm1cv.loc.S.se'] <-print(summary(lm(PM25~pred.m1.both,data=m1.2001.cv.loc))$coef[2,2])
#RMSPE
res[res$year==\"2001\", 'm1cv.loc.PE'] <- print(rmse(residuals(m1.fit.2001.cv)))

#spatial
spatial2001.cv.loc<-m1.2001.cv.loc %>%
    group_by(stn) %>%
    summarise(barpm = mean(PM25, na.rm=TRUE), barpred = mean(pred.m1, na.rm=TRUE)) 
m1.fit.2001.cv.loc.s <- lm(barpm ~ barpred, data=spatial2001.cv.loc)
res[res$year==\"2001\", 'm1cv.loc.R2.s'] <-  print(summary(lm(barpm ~ barpred, data=spatial2001.cv.loc))$r.squared)
res[res$year==\"2001\", 'm1cv.loc.PE.s'] <- print(rmse(residuals(m1.fit.2001.cv.loc.s)))
       
#temporal
tempo2001.loc.cv<-left_join(m1.2001.cv.loc,spatial2001.cv.loc)
tempo2001.loc.cv$delpm <-tempo2001.loc.cv$PM25-tempo2001.loc.cv$barpm
tempo2001.loc.cv$delpred <-tempo2001.loc.cv$pred.m1.both-tempo2001.loc.cv$barpred
mod_temporal.loc.cv <- lm(delpm ~ delpred, data=tempo2001.loc.cv)
res[res$year==\"2001\", 'm1cv.loc.R2.t'] <-  print(summary(lm(delpm ~ delpred, data=tempo2001.loc.cv))$r.squared)

#############save midpoint
saveRDS(res, \"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/res2001.m1.rds\")
saveRDS(res, \"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/resALL.rds\")
saveRDS(m1.2001.cv.loc,\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/mod1.AQ.2001.predCV.rds\")


###############
#MOD2
###############
m2.2001<-readRDS(\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/mod2.AQ.2001.rds\")


m2.2001[,elev.s:= scale(elev)]
m2.2001[,tden.s:= scale(tden)]
m2.2001[,pden.s:= scale(pden)]
m2.2001[,dist2A1.s:= scale(dist2A1)]
m2.2001[,dist2water.s:= scale(dist2water)]
m2.2001[,dist2rail.s:= scale(dist2rail)]
m2.2001[,Dist2road.s:= scale(Dist2road)]
m2.2001[,ndvi.s:= scale(ndvi)]
m2.2001[,MeanPbl.s:= scale(MeanPbl)]
m2.2001[,p_ind.s:= scale(p_ind)]
m2.2001[,p_for.s:= scale(p_for)]
m2.2001[,p_farm.s:= scale(p_farm)]
m2.2001[,p_dos.s:= scale(p_dos)]
m2.2001[,p_dev.s:= scale(p_dev)]
m2.2001[,p_os.s:= scale(p_os)]
m2.2001[,Temp.s:= scale(Temp)]
m2.2001[,WD.s:= scale(WD)]
m2.2001[,WS.s:= scale(WS)]
m2.2001[,RH.s:= scale(RH)]
m2.2001[,Rain.s:= scale(Rain)]

#generate predictions
m2.2001[, pred.m2 := predict(object=m1.fit.2001,newdata=m2.2001,allow.new.levels=TRUE,re.form=NULL)]
describe(m2.2001$pred.m2)
#delete implossible values
m2.2001 <- m2.2001[pred.m2 > 0.00000000000001 , ]
m2.2001 <- m2.2001[pred.m2 < 500   , ]

saveRDS(m2.2001,\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/mod2.AQ.2001.rds\")

#test
# describe(m2.2001$pred.m2)
# hist(m2.2001$pred.m2)

#######
#M2 R2
######
# m1.2001[,aodid:= paste(m1.2001$long_aod,m1.2001$lat_aod,sep=\"-\")]
# #merge co located mod1 and mod2 grids
# setkey(m1.2001,aodid,day)
# setkey(m2.2001,aodid,day)
# m.1.2.pred <- merge(m1.2001, m2.2001[, list(aodid, day, pred.m2)], all.x = T)
# mod2_reg<-lm(m.1.2.pred$predicted~m.1.2.pred$pred.m2)
# #cleanup and save current stages (workspace)
# summary(mod2_reg)$r.squared

#map the predictions
#aggregate by guid
m2_agg <- m2.2001[, list(LTPM.m2 = mean(pred.m2, na.rm = TRUE), lat_aod = lat_aod[1], long_aod = long_aod[1]), by = aodid]
#saveRDS(m2_agg, \"/media/NAS/Uni/Projects/P046.Israel_MAIAC/3.Work/2.Gather_data/FN008_model_prep/m2_agg_2001.rds\")
#map the predictions
write.csv(m2_agg, \"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/m2.2001.LTPM.csv\")
ggplot(m2_agg, aes(long_aod,lat_aod, color = LTPM.m2)) + 
  geom_point(size = 3, shape = 15) +  xlab(\"longitude\") + ylab(\"latitude\") + 
  scale_colour_gradientn(\"long term PM2.5 prediction\", colours = rainbow(5)) + theme_bw() + ggtitle(\"Long term predictions\")
ggsave(file=\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/LTPM.2001.m2.png\")
keep(res , sure=TRUE) 
gc()




###############
#LIBS
###############
library(lme4)
library(reshape)
library(foreign) 
library(ggplot2)
library(plyr)
library(data.table)
library(reshape2)
library(Hmisc)
library(mgcv)
library(gdata)
library(car)
library(dplyr)
library(ggmap)
library(broom)
library(splines)
#sourcing
source(\"/media/NAS/Uni/org/files/Uni/Projects/code/$Rsnips/CV_splits.r\")
source(\"/media/NAS/Uni/org/files/Uni/Projects/code/$Rsnips/rmspe.r\")


#-------------------->> RES TABLE
res <- matrix(nrow=9, ncol=45)
res <- data.frame(res)
colnames(res) <- c(
          \"year\"
          ,\"m1.R2\",\"m1.PE\",\"m1.R2.s\",\"m1.R2.t\",\"m1.PE.s\" #full model
          ,\"m1cv.R2\",\"m1cv.I\",\"m1cv.I.se\",\"m1cv.S\",\"m1cv.S.se\",\"m1cv.PE\",\"m1cv.R2.s\",\"m1cv.R2.t\",\"m1cv.PE.s\" #mod1 CV
          ,\"m1cv.loc.R2\",\"m1cv.loc.I\",\"m1cv.loc.I.se\",\"m1cv.loc.S\",\"m1cv.loc.S.se\",\"m1cv.loc.PE\",\"m1cv.loc.PE.s\",\"m1cv.loc.R2.s\",\"m1cv.loc.R2.t\"#loc m1
          ,\"mod2_R2\" #mod2
          ,\"m3.t31\",\"m3.t33\" #mod3 tests
          ,\"mod3_pm_mod3\",\"mod3_int\"
          ,\"mod3_int_SE\",\"mod3_Slope\",\"mod3_Slope SE\",\"mod3_RMSPE\"
          ,\"mod3_spatial\",\"mod3_temporal\",\"mod3_RMSPE_spatial\",
          \"mod3LPM_pm_mod3LPM\",\"mod3LPM_int\",\"mod3LPM_int_SE\",\"mod3LPM_Slope\",
                   \"mod3LPM_Slope SE\",\"mod3LPM_RMSPE\",\"mod3LPM_spatial\",\"mod3LPM_temporal\",\"mod3LPM_RMSPE_spatial\"
                   )
res$year <- c(2003:2011); 



### import data
m1.2002 <-readRDS(\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/mod1.AQ.2002.rds\")

### subset to aqua and apply alexei cleaning methods
m1.2002<-m1.2002[MaskAdjacency == \"000\" & UN > 0 & UN < 0.04] 

################# clean BAD STN PM25 and check if improved model?
rawdf <- ddply(m1.2002, c( \"stn\"), 
      function(x) {
        mod1 <- lm(PM25 ~ aod, data=x)
        data.frame(R2 = round(summary(mod1)$r.squared, 5), 
                   nsamps = length(summary(mod1)$resid))
})
rawdf
rawdf<-as.data.table(rawdf)
bad<- rawdf[R2< 0.05]
bad[,badid := paste(stn,sep=\"-\")]
#################BAD STN
m1.2002[,badid := paste(stn,sep=\"-\")]
####Take out bad stations
m1.2002 <- m1.2002[!(m1.2002$badid %in% bad$badid), ] 

#check it does better
m1.formula <- as.formula(PM25~ aod+(1+aod|day))
x<-  lmer(m1.formula,data=m1.2002)
m1.2002$predicted <- predict(x)
glance(lm(PM25~predicted,data=m1.2002))#0.74
#get rid of missing
m1.2002 <- na.omit(m1.2002)
m1.2002[,elev.s:= scale(elev)]
m1.2002[,tden.s:= scale(tden)]
m1.2002[,pden.s:= scale(pden)]
m1.2002[,dist2A1.s:= scale(dist2A1)]
m1.2002[,dist2water.s:= scale(dist2water)]
m1.2002[,dist2rail.s:= scale(dist2rail)]
m1.2002[,Dist2road.s:= scale(Dist2road)]
m1.2002[,ndvi.s:= scale(ndvi)]
m1.2002[,MeanPbl.s:= scale(MeanPbl)]
m1.2002[,p_ind.s:= scale(p_ind)]
m1.2002[,p_for.s:= scale(p_for)]
m1.2002[,p_farm.s:= scale(p_farm)]
m1.2002[,p_dos.s:= scale(p_dos)]
m1.2002[,p_dev.s:= scale(p_dev)]
m1.2002[,p_os.s:= scale(p_os)]
m1.2002[,Temp.s:= scale(Temp)]
m1.2002[,WD.s:= scale(WD)]
m1.2002[,WS.s:= scale(WS)]
m1.2002[,RH.s:= scale(RH)]
m1.2002[,Rain.s:= scale(Rain)]



m1.formula <- as.formula(PM25~ aod
                        +Temp.s+WD.s+RH.s+WS.s+Dust+Rain.s+MeanPbl.s #temporal
                        +elev.s+tden.s+pden.s+Dist2road.s+ndvi.s #spatial
                        +p_os.s #+p_dev.s+p_dos.s+p_farm.s+p_for.s+p_ind.s  #land use
                         #+aod*Dust #interactions
                         +(1+aod|day/reg_num)+(1|stn)) #0.812

#full fit
m1.fit.2002 <-  lmer(m1.formula,data=m1.2002,weights=normwt)
m1.2002$pred.m1 <- predict(m1.fit.2002)
res[res$year==\"2002\", 'm1.R2'] <- print(summary(lm(PM25~pred.m1,data=m1.2002))$r.squared)
#RMSPE
res[res$year==\"2002\", 'm1.PE'] <- print(rmse(residuals(m1.fit.2002)))

#spatial
###to check
spatial2002<-m1.2002 %>%
    group_by(stn) %>%
    summarise(barpm = mean(PM25, na.rm=TRUE), barpred = mean(pred.m1, na.rm=TRUE)) 
m1.fit.2002.spat<- lm(barpm ~ barpred, data=spatial2002)
res[res$year==\"2002\", 'm1.R2.s'] <-  print(summary(lm(barpm ~ barpred, data=spatial2002))$r.squared)
res[res$year==\"2002\", 'm1.PE.s'] <- print(rmse(residuals(m1.fit.2002.spat)))
       
#temporal
tempo2002<-left_join(m1.2002,spatial2002)
tempo2002$delpm <-tempo2002$PM25-tempo2002$barpm
tempo2002$delpred <-tempo2002$pred.m1-tempo2002$barpred
mod_temporal <- lm(delpm ~ delpred, data=tempo2002)
res[res$year==\"2002\", 'm1.R2.t'] <-  print(summary(lm(delpm ~ delpred, data=tempo2002))$r.squared)
saveRDS(m1.2002,\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/mod1.AQ.2002.pred.rds\")


#---------------->>>> CV
#s1
splits_s1 <- splitdf(m1.2002)
test_s1 <- splits_s1$testset
train_s1 <- splits_s1$trainset
out_train_s1 <- lmer(m1.formula,data =  train_s1,weights=normwt)
test_s1$pred.m1.cv <- predict(object=out_train_s1 ,newdata=test_s1,allow.new.levels=TRUE,re.form=NULL )
test_s1$iter<-\"s1\"
#s2
splits_s2 <- splitdf(m1.2002)
test_s2 <- splits_s2$testset
train_s2 <- splits_s2$trainset
out_train_s2 <- lmer(m1.formula,data =  train_s2,weights=normwt)
test_s2$pred.m1.cv <- predict(object=out_train_s2 ,newdata=test_s2,allow.new.levels=TRUE,re.form=NULL )
test_s2$iter<-\"s2\"
#s3
splits_s3 <- splitdf(m1.2002)
test_s3 <- splits_s3$testset
train_s3 <- splits_s3$trainset
out_train_s3 <- lmer(m1.formula,data =  train_s3,weights=normwt)
test_s3$pred.m1.cv <- predict(object=out_train_s3 ,newdata=test_s3,allow.new.levels=TRUE,re.form=NULL )
test_s3$iter<-\"s3\"
#s4
splits_s4 <- splitdf(m1.2002)
test_s4 <- splits_s4$testset
train_s4 <- splits_s4$trainset
out_train_s4 <- lmer(m1.formula,data =  train_s4,weights=normwt)
test_s4$pred.m1.cv <- predict(object=out_train_s4 ,newdata=test_s4,allow.new.levels=TRUE,re.form=NULL )
test_s4$iter<-\"s4\"
#s5
splits_s5 <- splitdf(m1.2002)
test_s5 <- splits_s5$testset
train_s5 <- splits_s5$trainset
out_train_s5 <- lmer(m1.formula,data =  train_s5,weights=normwt)
test_s5$pred.m1.cv <- predict(object=out_train_s5 ,newdata=test_s5,allow.new.levels=TRUE,re.form=NULL )
test_s5$iter<-\"s5\"
#s6
splits_s6 <- splitdf(m1.2002)
test_s6 <- splits_s6$testset
train_s6 <- splits_s6$trainset
out_train_s6 <- lmer(m1.formula,data =  train_s6,weights=normwt)
test_s6$pred.m1.cv <- predict(object=out_train_s6 ,newdata=test_s6,allow.new.levels=TRUE,re.form=NULL )
test_s6$iter<-\"s6\"
#s7
splits_s7 <- splitdf(m1.2002)
test_s7 <- splits_s7$testset
train_s7 <- splits_s7$trainset
out_train_s7 <- lmer(m1.formula,data =  train_s7,weights=normwt)
test_s7$pred.m1.cv <- predict(object=out_train_s7 ,newdata=test_s7,allow.new.levels=TRUE,re.form=NULL )
test_s7$iter<-\"s7\"
#s8
splits_s8 <- splitdf(m1.2002)
test_s8 <- splits_s8$testset
train_s8 <- splits_s8$trainset
out_train_s8 <- lmer(m1.formula,data =  train_s8,weights=normwt)
test_s8$pred.m1.cv <- predict(object=out_train_s8 ,newdata=test_s8,allow.new.levels=TRUE,re.form=NULL )
test_s8$iter<-\"s8\"
#s9
splits_s9 <- splitdf(m1.2002)
test_s9 <- splits_s9$testset
train_s9 <- splits_s9$trainset
out_train_s9 <- lmer(m1.formula,data =  train_s9,weights=normwt)
test_s9$pred.m1.cv <- predict(object=out_train_s9 ,newdata=test_s9,allow.new.levels=TRUE,re.form=NULL )
test_s9$iter<-\"s9\"
#s10
splits_s10 <- splitdf(m1.2002)
test_s10 <- splits_s10$testset
train_s10 <- splits_s10$trainset
out_train_s10 <- lmer(m1.formula,data =  train_s10,weights=normwt)
test_s10$pred.m1.cv <- predict(object=out_train_s10 ,newdata=test_s10,allow.new.levels=TRUE,re.form=NULL )
test_s10$iter<-\"s10\"

#BIND 1 dataset
m1.2002.cv<- data.table(rbind(test_s1,test_s2,test_s3,test_s4,test_s5,test_s6,test_s7,test_s8,test_s9, test_s10))
# cleanup (remove from WS) objects from CV
rm(list = ls(pattern = \"train_|test_\"))
#table updates
m1.fit.2002.cv<-lm(PM25~pred.m1.cv,data=m1.2002.cv)
res[res$year==\"2002\", 'm1cv.R2'] <- print(summary(lm(PM25~pred.m1.cv,data=m1.2002.cv))$r.squared)
res[res$year==\"2002\", 'm1cv.I'] <-print(summary(lm(PM25~pred.m1.cv,data=m1.2002.cv))$coef[1,1])
res[res$year==\"2002\", 'm1cv.I.se'] <-print(summary(lm(PM25~pred.m1.cv,data=m1.2002.cv))$coef[1,2])
res[res$year==\"2002\", 'm1cv.S'] <-print(summary(lm(PM25~pred.m1.cv,data=m1.2002.cv))$coef[2,1])
res[res$year==\"2002\", 'm1cv.S.se'] <-print(summary(lm(PM25~pred.m1.cv,data=m1.2002.cv))$coef[2,2])
#RMSPE
res[res$year==\"2002\", 'm1cv.PE'] <- print(rmse(residuals(m1.fit.2002.cv)))

#spatial
spatial2002.cv<-m1.2002.cv %>%
    group_by(stn) %>%
    summarise(barpm = mean(PM25, na.rm=TRUE), barpred = mean(pred.m1, na.rm=TRUE)) 
m1.fit.2002.cv.s <- lm(barpm ~ barpred, data=spatial2002.cv)
res[res$year==\"2002\", 'm1cv.R2.s'] <-  print(summary(lm(barpm ~ barpred, data=spatial2002.cv))$r.squared)
res[res$year==\"2002\", 'm1cv.PE.s'] <- print(rmse(residuals(m1.fit.2002.cv.s)))
       
#temporal
tempo2002.cv<-left_join(m1.2002.cv,spatial2002.cv)
tempo2002.cv$delpm <-tempo2002.cv$PM25-tempo2002.cv$barpm
tempo2002.cv$delpred <-tempo2002.cv$pred.m1.cv-tempo2002.cv$barpred
mod_temporal.cv <- lm(delpm ~ delpred, data=tempo2002.cv)
res[res$year==\"2002\", 'm1cv.R2.t'] <-  print(summary(lm(delpm ~ delpred, data=tempo2002.cv))$r.squared)



#-------->>> loc stage
luf<-fread(\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN004_LU_full_dataset/local.csv\")
setnames(luf,\"tden\",\"loc.tden\")
setnames(luf,\"elev50\",\"loc.elev\")

#add 50m LU to CV data
setkey(m1.2002.cv,stn)
setkey(luf,stn)
m1.2002.cv.loc <- merge(m1.2002.cv, luf, all.x = T)
m1.2002.cv.loc<-na.omit(m1.2002.cv.loc)

#create residual mp3 variable
m1.2002.cv.loc$res.m1<-m1.2002.cv.loc$PM25-m1.2002.cv.loc$pred.m1.cv

#The GAM model
gam.out<-gam(res.m1~s(loc.tden)+s(tden,MeanPbl)+s(loc.tden,WS)+s(loc_p_os,fx=FALSE,k=4,bs='cr')+s(loc.elev,fx=FALSE,k=4,bs='cr')+s(dA1,fx=FALSE,k=4,bs='cr')+s(dsea,fx=FALSE,k=4,bs='cr'),data=m1.2002.cv.loc)
#plot(bp.model.ps)
#summary(bp.model.ps)
## reg
m1.2002.cv.loc$pred.m1.loc <-predict(gam.out)
m1.2002.cv.loc$pred.m1.both <- m1.2002.cv.loc$pred.m1.cv + m1.2002.cv.loc$pred.m1.loc
res[res$year==\"2002\", 'm1cv.loc.R2'] <- print(summary(lm(PM25~pred.m1.both,data=m1.2002.cv.loc))$r.squared)
res[res$year==\"2002\", 'm1cv.loc.I'] <-print(summary(lm(PM25~pred.m1.both,data=m1.2002.cv.loc))$coef[1,1])
res[res$year==\"2002\", 'm1cv.loc.I.se'] <-print(summary(lm(PM25~pred.m1.both,data=m1.2002.cv.loc))$coef[1,2])
res[res$year==\"2002\", 'm1cv.loc.S'] <-print(summary(lm(PM25~pred.m1.both,data=m1.2002.cv.loc))$coef[2,1])
res[res$year==\"2002\", 'm1cv.loc.S.se'] <-print(summary(lm(PM25~pred.m1.both,data=m1.2002.cv.loc))$coef[2,2])
#RMSPE
res[res$year==\"2002\", 'm1cv.loc.PE'] <- print(rmse(residuals(m1.fit.2002.cv)))

#spatial
spatial2002.cv.loc<-m1.2002.cv.loc %>%
    group_by(stn) %>%
    summarise(barpm = mean(PM25, na.rm=TRUE), barpred = mean(pred.m1, na.rm=TRUE)) 
m1.fit.2002.cv.loc.s <- lm(barpm ~ barpred, data=spatial2002.cv.loc)
res[res$year==\"2002\", 'm1cv.loc.R2.s'] <-  print(summary(lm(barpm ~ barpred, data=spatial2002.cv.loc))$r.squared)
res[res$year==\"2002\", 'm1cv.loc.PE.s'] <- print(rmse(residuals(m1.fit.2002.cv.loc.s)))
       
#temporal
tempo2002.loc.cv<-left_join(m1.2002.cv.loc,spatial2002.cv.loc)
tempo2002.loc.cv$delpm <-tempo2002.loc.cv$PM25-tempo2002.loc.cv$barpm
tempo2002.loc.cv$delpred <-tempo2002.loc.cv$pred.m1.both-tempo2002.loc.cv$barpred
mod_temporal.loc.cv <- lm(delpm ~ delpred, data=tempo2002.loc.cv)
res[res$year==\"2002\", 'm1cv.loc.R2.t'] <-  print(summary(lm(delpm ~ delpred, data=tempo2002.loc.cv))$r.squared)

#############save midpoint
saveRDS(res, \"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/res2002.m1.rds\")
saveRDS(res, \"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/resALL.rds\")
saveRDS(m1.2002.cv.loc,\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/mod1.AQ.2002.predCV.rds\")


###############
#MOD2
###############
m2.2002<-readRDS(\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/mod2.AQ.2002.rds\")


m2.2002[,elev.s:= scale(elev)]
m2.2002[,tden.s:= scale(tden)]
m2.2002[,pden.s:= scale(pden)]
m2.2002[,dist2A1.s:= scale(dist2A1)]
m2.2002[,dist2water.s:= scale(dist2water)]
m2.2002[,dist2rail.s:= scale(dist2rail)]
m2.2002[,Dist2road.s:= scale(Dist2road)]
m2.2002[,ndvi.s:= scale(ndvi)]
m2.2002[,MeanPbl.s:= scale(MeanPbl)]
m2.2002[,p_ind.s:= scale(p_ind)]
m2.2002[,p_for.s:= scale(p_for)]
m2.2002[,p_farm.s:= scale(p_farm)]
m2.2002[,p_dos.s:= scale(p_dos)]
m2.2002[,p_dev.s:= scale(p_dev)]
m2.2002[,p_os.s:= scale(p_os)]
m2.2002[,Temp.s:= scale(Temp)]
m2.2002[,WD.s:= scale(WD)]
m2.2002[,WS.s:= scale(WS)]
m2.2002[,RH.s:= scale(RH)]
m2.2002[,Rain.s:= scale(Rain)]

#generate predictions
m2.2002[, pred.m2 := predict(object=m1.fit.2002,newdata=m2.2002,allow.new.levels=TRUE,re.form=NULL)]
describe(m2.2002$pred.m2)
#delete implossible values
m2.2002 <- m2.2002[pred.m2 > 0.00000000000001 , ]
m2.2002 <- m2.2002[pred.m2 < 500   , ]

saveRDS(m2.2002,\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/mod2.AQ.2002.rds\")

#test
# describe(m2.2002$pred.m2)
# hist(m2.2002$pred.m2)

#######
#M2 R2
######
# m1.2002[,aodid:= paste(m1.2002$long_aod,m1.2002$lat_aod,sep=\"-\")]
# #merge co located mod1 and mod2 grids
# setkey(m1.2002,aodid,day)
# setkey(m2.2002,aodid,day)
# m.1.2.pred <- merge(m1.2002, m2.2002[, list(aodid, day, pred.m2)], all.x = T)
# mod2_reg<-lm(m.1.2.pred$predicted~m.1.2.pred$pred.m2)
# #cleanup and save current stages (workspace)
# summary(mod2_reg)$r.squared

#map the predictions
#aggregate by guid
m2_agg <- m2.2002[, list(LTPM.m2 = mean(pred.m2, na.rm = TRUE), lat_aod = lat_aod[1], long_aod = long_aod[1]), by = aodid]
#saveRDS(m2_agg, \"/media/NAS/Uni/Projects/P046.Israel_MAIAC/3.Work/2.Gather_data/FN008_model_prep/m2_agg_2002.rds\")
#map the predictions
write.csv(m2_agg, \"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/m2.2002.LTPM.csv\")
ggplot(m2_agg, aes(long_aod,lat_aod, color = LTPM.m2)) + 
  geom_point(size = 3, shape = 15) +  xlab(\"longitude\") + ylab(\"latitude\") + 
  scale_colour_gradientn(\"long term PM2.5 prediction\", colours = rainbow(5)) + theme_bw() + ggtitle(\"Long term predictions\")
ggsave(file=\"/media/NAS/Uni/Projects/P046_Israel_MAIAC/3.Work/2.Gather_data/FN000_RWORKDIR/LTPM.2002.m2.png\")
keep(res , sure=TRUE) 
gc()



" 1 16 (fontified t face font-lock-comment-delimiter-face) 16 17 (fontified t face font-lock-comment-face) 17 18 (fontified t face font-lock-comment-delimiter-face) 18 23 (fontified t face font-lock-comment-face) 23 38 (fontified t face font-lock-comment-delimiter-face) 38 39 (fontified t face font-lock-comment-face) 39 46 (fontified t face font-lock-constant-face) 46 53 (fontified t) 53 60 (fontified t face font-lock-constant-face) 60 70 (fontified t) 70 77 (fontified t face font-lock-constant-face) 77 88 (fontified t) 88 95 (fontified t face font-lock-constant-face) 95 105 (fontified t) 105 112 (fontified t face font-lock-constant-face) 112 119 (fontified t) 119 126 (fontified t face font-lock-constant-face) 126 139 (fontified t) 139 146 (fontified t face font-lock-constant-face) 146 157 (fontified t) 157 164 (fontified t face font-lock-constant-face) 164 172 (fontified t) 172 179 (fontified t face font-lock-constant-face) 179 186 (fontified t) 186 193 (fontified t face font-lock-constant-face) 193 201 (fontified t) 201 208 (fontified t face font-lock-constant-face) 208 214 (fontified t) 214 221 (fontified t face font-lock-constant-face) 221 229 (fontified t) 229 236 (fontified t face font-lock-constant-face) 236 244 (fontified t) 244 251 (fontified t face font-lock-constant-face) 251 259 (fontified t) 259 266 (fontified t face font-lock-constant-face) 266 276 (fontified t) 276 277 (fontified t face font-lock-comment-delimiter-face) 277 286 (fontified t face font-lock-comment-face) 286 292 (fontified t face font-lock-constant-face) 292 293 (fontified t) 293 357 (fontified t face font-lock-string-face) 357 359 (fontified t) 359 365 (fontified t face font-lock-constant-face) 365 366 (fontified t) 366 426 (fontified t face font-lock-string-face) 426 430 (fontified t) 430 431 (fontified t face font-lock-comment-delimiter-face) 431 464 (fontified t face font-lock-comment-face) 464 468 (fontified t) 468 470 (fontified t face font-lock-constant-face) 470 499 (fontified t) 499 501 (fontified t face font-lock-constant-face) 501 518 (fontified t) 518 532 (fontified t) 532 534 (fontified t face font-lock-constant-face) 534 548 (fontified t) 548 554 (fontified t face font-lock-string-face) 554 566 (fontified t) 566 573 (fontified t face font-lock-string-face) 573 574 (fontified t) 574 581 (fontified t face font-lock-string-face) 581 582 (fontified t) 582 591 (fontified t face font-lock-string-face) 591 592 (fontified t) 592 601 (fontified t face font-lock-string-face) 601 602 (fontified t) 602 611 (fontified t face font-lock-string-face) 611 612 (fontified t) 612 613 (fontified t face font-lock-comment-delimiter-face) 613 624 (fontified t face font-lock-comment-face) 624 635 (fontified t) 635 644 (fontified t face font-lock-string-face) 644 645 (fontified t) 645 653 (fontified t face font-lock-string-face) 653 654 (fontified t) 654 665 (fontified t face font-lock-string-face) 665 666 (fontified t) 666 674 (fontified t face font-lock-string-face) 674 675 (fontified t) 675 686 (fontified t face font-lock-string-face) 686 687 (fontified t) 687 696 (fontified t face font-lock-string-face) 696 697 (fontified t) 697 708 (fontified t face font-lock-string-face) 708 709 (fontified t) 709 720 (fontified t face font-lock-string-face) 720 721 (fontified t) 721 732 (fontified t face font-lock-string-face) 732 733 (fontified t) 733 734 (fontified t face font-lock-comment-delimiter-face) 734 742 (fontified t face font-lock-comment-face) 742 753 (fontified t) 753 766 (fontified t face font-lock-string-face) 766 767 (fontified t) 767 779 (fontified t face font-lock-string-face) 779 780 (fontified t) 780 795 (fontified t face font-lock-string-face) 795 796 (fontified t) 796 808 (fontified t face font-lock-string-face) 808 809 (fontified t) 809 824 (fontified t face font-lock-string-face) 824 825 (fontified t) 825 838 (fontified t face font-lock-string-face) 838 839 (fontified t) 839 854 (fontified t face font-lock-string-face) 854 855 (fontified t) 855 870 (fontified t face font-lock-string-face) 870 871 (fontified t) 871 886 (fontified t face font-lock-string-face) 886 887 (fontified t face font-lock-comment-delimiter-face) 887 894 (fontified t face font-lock-comment-face) 894 905 (fontified t) 905 914 (fontified t face font-lock-string-face) 914 915 (fontified t) 915 916 (fontified t face font-lock-comment-delimiter-face) 916 921 (fontified t face font-lock-comment-face) 921 932 (fontified t) 932 940 (fontified t face font-lock-string-face) 940 941 (fontified t) 941 949 (fontified t face font-lock-string-face) 949 950 (fontified t) 950 951 (fontified t face font-lock-comment-delimiter-face) 951 962 (fontified t face font-lock-comment-face) 962 973 (fontified t) 973 987 (fontified t face font-lock-string-face) 987 988 (fontified t) 988 998 (fontified t face font-lock-string-face) 998 1010 (fontified t) 1010 1023 (fontified t face font-lock-string-face) 1023 1024 (fontified t) 1024 1036 (fontified t face font-lock-string-face) 1036 1037 (fontified t) 1037 1052 (fontified t face font-lock-string-face) 1052 1053 (fontified t) 1053 1065 (fontified t face font-lock-string-face) 1065 1066 (fontified t) 1066 1077 (fontified t) 1077 1091 (fontified t face font-lock-string-face) 1091 1092 (fontified t) 1092 1107 (fontified t face font-lock-string-face) 1107 1108 (fontified t) 1108 1128 (fontified t face font-lock-string-face) 1128 1140 (fontified t) 1140 1160 (fontified t face font-lock-string-face) 1160 1161 (fontified t) 1161 1174 (fontified t face font-lock-string-face) 1174 1175 (fontified t) 1175 1191 (fontified t face font-lock-string-face) 1191 1192 (fontified t) 1192 1207 (fontified t face font-lock-string-face) 1207 1228 (fontified t) 1228 1246 (fontified t face font-lock-string-face) 1246 1247 (fontified t) 1247 1262 (fontified t face font-lock-string-face) 1262 1263 (fontified t) 1263 1280 (fontified t face font-lock-string-face) 1280 1281 (fontified t) 1281 1299 (fontified t face font-lock-string-face) 1299 1300 (fontified t) 1300 1323 (fontified t face font-lock-string-face) 1323 1354 (fontified t) 1354 1356 (fontified t face font-lock-constant-face) 1356 1375 (fontified t) 1375 1379 (fontified t face font-lock-comment-delimiter-face) 1379 1391 (fontified t face font-lock-comment-face) 1391 1394 (fontified t) 1398 1399 (fontified t) 1399 1401 (fontified t face font-lock-constant-face) 1401 1409 (fontified t) 1409 1496 (fontified t face font-lock-string-face) 1500 1505 (fontified t face font-lock-string-face) 1505 1507 (fontified t) 1507 1508 (fontified t) 1508 1512 (face font-lock-comment-delimiter-face) 1512 1561 (face font-lock-comment-face) 1568 1570 (face font-lock-constant-face) 1595 1600 (face font-lock-string-face) 1625 1643 (face font-lock-comment-delimiter-face) 1643 1691 (face font-lock-comment-face) 1697 1699 (face font-lock-constant-face) 1718 1723 (face font-lock-string-face) 1733 1741 (face font-lock-keyword-face) 1760 1762 (face font-lock-constant-face) 1917 1919 (face font-lock-constant-face) 1943 1945 (face font-lock-constant-face) 1990 1993 (face font-lock-string-face) 1996 2013 (face font-lock-comment-delimiter-face) 2013 2021 (face font-lock-comment-face) 2053 2056 (face font-lock-string-face) 2059 2063 (face font-lock-comment-delimiter-face) 2063 2085 (face font-lock-comment-face) 2093 2095 (face font-lock-constant-face) 2121 2123 (face font-lock-keyword-face) 2141 2142 (face font-lock-comment-delimiter-face) 2142 2163 (face font-lock-comment-face) 2174 2176 (face font-lock-constant-face) 2212 2214 (face font-lock-constant-face) 2264 2266 (face font-lock-constant-face) 2317 2318 (face font-lock-comment-delimiter-face) 2318 2323 (face font-lock-comment-face) 2323 2324 (face font-lock-comment-delimiter-face) 2324 2343 (face font-lock-comment-face) 2351 2353 (face font-lock-constant-face) 3049 3051 (face font-lock-constant-face) 3142 3143 (face font-lock-comment-delimiter-face) 3143 3152 (face font-lock-comment-face) 3217 3218 (face font-lock-comment-delimiter-face) 3218 3226 (face font-lock-comment-face) 11895 11898 (fontified t) 11902 11929 (fontified t) 11933 11966 (fontified t) 11970 12009 (fontified t) 12013 12050 (fontified t) 12054 12091 (fontified t) 12095 12122 (fontified t) 12126 12159 (fontified t) 12163 12192 (fontified t) 12196 12225 (fontified t) 12229 12260 (fontified t) 12264 12293 (fontified t) 12297 12326 (fontified t) 12330 12357 (fontified t) 12361 12388 (fontified t) 12392 12412 (fontified t) 12412 12415 (fontified t) 12419 12442 (fontified t) 12446 12469 (fontified t) 12473 12498 (fontified t) 12498 12499 (fontified t face font-lock-comment-delimiter-face) 12499 12520 (fontified t face font-lock-comment-face) 12520 12523 (fontified t) 12527 12563 (fontified t) 12567 12579 (fontified t) 12583 12601 (fontified t) 12601 12605 (fontified t face font-lock-type-face) 12605 12614 (fontified t) 12614 12618 (fontified t face font-lock-type-face) 12618 12633 (fontified t) 12637 12647 (fontified t) 12647 12648 (fontified t face font-lock-comment-delimiter-face) 12648 12674 (fontified t face font-lock-comment-face) 12674 12677 (fontified t) 12681 12682 (fontified t) 12682 12684 (fontified t face font-lock-constant-face) 12684 12688 (fontified t) 12692 12727 (fontified t) 12731 12732 (fontified t) 12732 12734 (fontified t face font-lock-constant-face) 12734 12738 (fontified t) 12742 12775 (fontified t) 12779 12780 (fontified t) 12780 12867 (fontified t face font-lock-string-face) 12871 12876 (fontified t face font-lock-string-face) 12876 12879 (fontified t) 12879 12880 (fontified t face font-lock-comment-delimiter-face) 12880 12885 (fontified t face font-lock-comment-face) 12885 12887 (fontified t face font-lock-comment-delimiter-face) 12887 12899 (fontified t face font-lock-comment-face) 12903 12913 (fontified t face font-lock-comment-face) 12913 12915 (fontified t face font-lock-comment-delimiter-face) 12915 12923 (fontified t face font-lock-comment-face) 12927 12937 (fontified t face font-lock-comment-face) 12937 12938 (fontified t) 12938 12945 (fontified t face font-lock-comment-delimiter-face) 12945 12946 (fontified t face font-lock-comment-face) 12946 12947 (fontified t face font-lock-comment-delimiter-face) 12947 12953 (fontified t face font-lock-comment-face) 12953 12959 (fontified t face font-lock-comment-delimiter-face) 12959 12960 (fontified t face font-lock-comment-face) 12960 12962 (fontified t face font-lock-comment-delimiter-face) 12962 12965 (fontified t face font-lock-comment-face) 12969 12988 (fontified t face font-lock-comment-face) 12992 13005 (fontified t face font-lock-comment-face) 13009 13028 (fontified t face font-lock-comment-face) 13028 13030 (fontified t face font-lock-comment-delimiter-face) 13030 13068 (fontified t face font-lock-comment-face) 13068 13070 (fontified t face font-lock-comment-delimiter-face) 13070 13080 (fontified t face font-lock-comment-face) 13084 13096 (fontified t face font-lock-comment-face) 13096 13098 (fontified t face font-lock-comment-delimiter-face) 13098 13108 (fontified t face font-lock-comment-face) 13112 13124 (fontified t face font-lock-comment-face) 13124 13126 (fontified t face font-lock-comment-delimiter-face) 13126 13149 (fontified t face font-lock-comment-face) 13153 13158 (fontified t face font-lock-comment-face) 13162 13204 (fontified t face font-lock-comment-face) 13204 13206 (fontified t face font-lock-comment-delimiter-face) 13206 13260 (fontified t face font-lock-comment-face) 13260 13262 (fontified t face font-lock-comment-delimiter-face) 13262 13307 (fontified t face font-lock-comment-face) 13307 13309 (fontified t face font-lock-comment-delimiter-face) 13309 13337 (fontified t face font-lock-comment-face) 13337 13338 (fontified t) 13338 13339 (fontified t face font-lock-comment-delimiter-face) 13339 13359 (fontified t face font-lock-comment-face) 13359 13360 (fontified t face font-lock-comment-delimiter-face) 13360 13378 (fontified t face font-lock-comment-face) 13378 13385 (fontified t) 13385 13387 (fontified t face font-lock-constant-face) 13387 13391 (fontified t) 13395 13435 (fontified t) 13435 13439 (fontified t face font-lock-type-face) 13439 13501 (fontified t) 13501 13502 (fontified t face font-lock-comment-delimiter-face) 13502 13606 (fontified t face font-lock-comment-face) 13610 13617 (fontified t face font-lock-comment-face) 13617 13618 (fontified t face font-lock-comment-delimiter-face) 13618 13638 (fontified t face font-lock-comment-face) 13638 13656 (fontified t) 13656 13738 (fontified t face font-lock-string-face) 13742 13752 (fontified t face font-lock-string-face) 13752 13754 (fontified t) 13754 13812 (fontified t) 13812 13855 (fontified t) 13855 13866 (fontified t face font-lock-string-face) 13866 13875 (fontified t) 13875 13885 (fontified t face font-lock-string-face) 13885 13915 (fontified t) 13915 13943 (fontified t face font-lock-string-face) 13943 13990 (fontified t) 13990 14013 (fontified t face font-lock-string-face) 14013 14015 (fontified t) 14015 14027 (fontified t) 14027 14111 (fontified t face font-lock-string-face) 14115 14123 (fontified t face font-lock-string-face) 14123 14125 (fontified t) 14125 14141 (fontified t) 14141 14145 (fontified t face font-lock-type-face) 14145 14156 (fontified t) 14157 14172 (fontified t face font-lock-comment-delimiter-face) 14172 14173 (fontified t face font-lock-comment-face) 14173 14174 (fontified t face font-lock-comment-delimiter-face) 14174 14179 (fontified t face font-lock-comment-face) 14179 14194 (fontified t face font-lock-comment-delimiter-face) 14194 14195 (fontified t face font-lock-comment-face) 14195 14202 (fontified t face font-lock-constant-face) 14202 14209 (fontified t) 14209 14216 (fontified t face font-lock-constant-face) 14216 14226 (fontified t) 14226 14233 (fontified t face font-lock-constant-face) 14233 14244 (fontified t) 14244 14251 (fontified t face font-lock-constant-face) 14251 14261 (fontified t) 14261 14268 (fontified t face font-lock-constant-face) 14268 14275 (fontified t) 14275 14282 (fontified t face font-lock-constant-face) 14282 14295 (fontified t) 14295 14302 (fontified t face font-lock-constant-face) 14302 14313 (fontified t) 14313 14320 (fontified t face font-lock-constant-face) 14320 14328 (fontified t) 14328 14335 (fontified t face font-lock-constant-face) 14335 14342 (fontified t) 14342 14349 (fontified t face font-lock-constant-face) 14349 14357 (fontified t) 14357 14364 (fontified t face font-lock-constant-face) 14364 14370 (fontified t) 14370 14377 (fontified t face font-lock-constant-face) 14377 14385 (fontified t) 14385 14392 (fontified t face font-lock-constant-face) 14392 14400 (fontified t) 14400 14407 (fontified t face font-lock-constant-face) 14407 14415 (fontified t) 14415 14422 (fontified t face font-lock-constant-face) 14422 14432 (fontified t) 14432 14433 (fontified t face font-lock-comment-delimiter-face) 14433 14442 (fontified t face font-lock-comment-face) 14442 14448 (fontified t face font-lock-constant-face) 14448 14449 (fontified t) 14449 14513 (fontified t face font-lock-string-face) 14513 14515 (fontified t) 14515 14521 (fontified t face font-lock-constant-face) 14521 14522 (fontified t) 14522 14582 (fontified t face font-lock-string-face) 14582 14586 (fontified t) 14586 14587 (fontified t face font-lock-comment-delimiter-face) 14587 14620 (fontified t face font-lock-comment-face) 14620 14624 (fontified t) 14624 14626 (fontified t face font-lock-constant-face) 14626 14655 (fontified t) 14655 14657 (fontified t face font-lock-constant-face) 14657 14674 (fontified t) 14674 14688 (fontified t) 14688 14690 (fontified t face font-lock-constant-face) 14690 14704 (fontified t) 14704 14710 (fontified t face font-lock-string-face) 14710 14722 (fontified t) 14722 14729 (fontified t face font-lock-string-face) 14729 14730 (fontified t) 14730 14737 (fontified t face font-lock-string-face) 14737 14738 (fontified t) 14738 14747 (fontified t face font-lock-string-face) 14747 14748 (fontified t) 14748 14757 (fontified t face font-lock-string-face) 14757 14758 (fontified t) 14758 14767 (fontified t face font-lock-string-face) 14767 14768 (fontified t) 14768 14769 (fontified t face font-lock-comment-delimiter-face) 14769 14780 (fontified t face font-lock-comment-face) 14780 14791 (fontified t) 14791 14800 (fontified t face font-lock-string-face) 14800 14801 (fontified t) 14801 14809 (fontified t face font-lock-string-face) 14809 14810 (fontified t) 14810 14821 (fontified t face font-lock-string-face) 14821 14822 (fontified t) 14822 14830 (fontified t face font-lock-string-face) 14830 14831 (fontified t) 14831 14842 (fontified t face font-lock-string-face) 14842 14843 (fontified t) 14843 14852 (fontified t face font-lock-string-face) 14852 14853 (fontified t) 14853 14864 (fontified t face font-lock-string-face) 14864 14865 (fontified t) 14865 14876 (fontified t face font-lock-string-face) 14876 14877 (fontified t) 14877 14888 (fontified t face font-lock-string-face) 14888 14889 (fontified t) 14889 14890 (fontified t face font-lock-comment-delimiter-face) 14890 14898 (fontified t face font-lock-comment-face) 14898 14909 (fontified t) 14909 14922 (fontified t face font-lock-string-face) 14922 14923 (fontified t) 14923 14935 (fontified t face font-lock-string-face) 14935 14936 (fontified t) 14936 14951 (fontified t face font-lock-string-face) 14951 14952 (fontified t) 14952 14964 (fontified t face font-lock-string-face) 14964 14965 (fontified t) 14965 14980 (fontified t face font-lock-string-face) 14980 14981 (fontified t) 14981 14994 (fontified t face font-lock-string-face) 14994 14995 (fontified t) 14995 15010 (fontified t face font-lock-string-face) 15010 15011 (fontified t) 15011 15026 (fontified t face font-lock-string-face) 15026 15027 (fontified t) 15027 15042 (fontified t face font-lock-string-face) 15042 15043 (fontified t face font-lock-comment-delimiter-face) 15043 15050 (fontified t face font-lock-comment-face) 15050 15061 (fontified t) 15061 15070 (fontified t face font-lock-string-face) 15070 15071 (fontified t) 15071 15072 (fontified t face font-lock-comment-delimiter-face) 15072 15077 (fontified t face font-lock-comment-face) 15077 15088 (fontified t) 15088 15096 (fontified t face font-lock-string-face) 15096 15097 (fontified t) 15097 15105 (fontified t face font-lock-string-face) 15105 15106 (fontified t) 15106 15107 (fontified t face font-lock-comment-delimiter-face) 15107 15118 (fontified t face font-lock-comment-face) 15118 15129 (fontified t) 15129 15143 (fontified t face font-lock-string-face) 15143 15144 (fontified t) 15144 15154 (fontified t face font-lock-string-face) 15154 15166 (fontified t) 15166 15179 (fontified t face font-lock-string-face) 15179 15180 (fontified t) 15180 15192 (fontified t face font-lock-string-face) 15192 15193 (fontified t) 15193 15208 (fontified t face font-lock-string-face) 15208 15209 (fontified t) 15209 15221 (fontified t face font-lock-string-face) 15221 15222 (fontified t) 15222 15233 (fontified t) 15233 15247 (fontified t face font-lock-string-face) 15247 15248 (fontified t) 15248 15263 (fontified t face font-lock-string-face) 15263 15264 (fontified t) 15264 15284 (fontified t face font-lock-string-face) 15284 15296 (fontified t) 15296 15316 (fontified t face font-lock-string-face) 15316 15317 (fontified t) 15317 15330 (fontified t face font-lock-string-face) 15330 15331 (fontified t) 15331 15347 (fontified t face font-lock-string-face) 15347 15348 (fontified t) 15348 15363 (fontified t face font-lock-string-face) 15363 15384 (fontified t) 15384 15402 (fontified t face font-lock-string-face) 15402 15403 (fontified t) 15403 15418 (fontified t face font-lock-string-face) 15418 15419 (fontified t) 15419 15436 (fontified t face font-lock-string-face) 15436 15437 (fontified t) 15437 15455 (fontified t face font-lock-string-face) 15455 15456 (fontified t) 15456 15479 (fontified t face font-lock-string-face) 15479 15510 (fontified t) 15510 15512 (fontified t face font-lock-constant-face) 15512 15531 (fontified t) 15531 15535 (fontified t face font-lock-comment-delimiter-face) 15535 15547 (fontified t face font-lock-comment-face) 15547 15550 (fontified t) 15554 15555 (fontified t) 15555 15557 (fontified t face font-lock-constant-face) 15557 15565 (fontified t) 15565 15652 (fontified t face font-lock-string-face) 15656 15661 (fontified t face font-lock-string-face) 15661 15663 (fontified t) 15663 15664 (fontified t) 15664 15668 (face font-lock-comment-delimiter-face) 15668 15717 (face font-lock-comment-face) 15724 15726 (face font-lock-constant-face) 15751 15756 (face font-lock-string-face) 15781 15799 (face font-lock-comment-delimiter-face) 15799 15847 (face font-lock-comment-face) 15853 15855 (face font-lock-constant-face) 15874 15879 (face font-lock-string-face) 15889 15897 (face font-lock-keyword-face) 15916 15918 (face font-lock-constant-face) 16073 16075 (face font-lock-constant-face) 16099 16101 (face font-lock-constant-face) 16146 16149 (face font-lock-string-face) 16152 16169 (face font-lock-comment-delimiter-face) 16169 16177 (face font-lock-comment-face) 16209 16212 (face font-lock-string-face) 16215 16219 (face font-lock-comment-delimiter-face) 16219 16241 (face font-lock-comment-face) 16249 16251 (face font-lock-constant-face) 16277 16279 (face font-lock-keyword-face) 16297 16298 (face font-lock-comment-delimiter-face) 16298 16319 (face font-lock-comment-face) 16330 16332 (face font-lock-constant-face) 16368 16370 (face font-lock-constant-face) 16420 16422 (face font-lock-constant-face) 16473 16474 (face font-lock-comment-delimiter-face) 16474 16479 (face font-lock-comment-face) 16479 16480 (face font-lock-comment-delimiter-face) 16480 16499 (face font-lock-comment-face) 16507 16509 (face font-lock-constant-face) 17205 17207 (face font-lock-constant-face) 17298 17299 (face font-lock-comment-delimiter-face) 17299 17308 (face font-lock-comment-face) 17373 17374 (face font-lock-comment-delimiter-face) 17374 17382 (face font-lock-comment-face) 26051 26054 (fontified t) 26058 26085 (fontified t) 26089 26122 (fontified t) 26126 26165 (fontified t) 26169 26206 (fontified t) 26210 26247 (fontified t) 26251 26278 (fontified t) 26282 26315 (fontified t) 26319 26348 (fontified t) 26352 26381 (fontified t) 26385 26416 (fontified t) 26420 26449 (fontified t) 26453 26482 (fontified t) 26486 26513 (fontified t) 26517 26544 (fontified t) 26548 26568 (fontified t) 26568 26571 (fontified t) 26575 26598 (fontified t) 26602 26625 (fontified t) 26629 26654 (fontified t) 26654 26655 (fontified t face font-lock-comment-delimiter-face) 26655 26676 (fontified t face font-lock-comment-face) 26676 26679 (fontified t) 26683 26719 (fontified t) 26723 26735 (fontified t) 26739 26757 (fontified t) 26757 26761 (fontified t face font-lock-type-face) 26761 26770 (fontified t) 26770 26774 (fontified t face font-lock-type-face) 26774 26789 (fontified t) 26793 26803 (fontified t) 26803 26804 (fontified t face font-lock-comment-delimiter-face) 26804 26830 (fontified t face font-lock-comment-face) 26830 26833 (fontified t) 26837 26838 (fontified t) 26838 26840 (fontified t face font-lock-constant-face) 26840 26844 (fontified t) 26848 26883 (fontified t) 26887 26888 (fontified t) 26888 26890 (fontified t face font-lock-constant-face) 26890 26894 (fontified t) 26898 26931 (fontified t) 26935 26936 (fontified t) 26936 27023 (fontified t face font-lock-string-face) 27027 27032 (fontified t face font-lock-string-face) 27032 27035 (fontified t) 27035 27036 (fontified t face font-lock-comment-delimiter-face) 27036 27041 (fontified t face font-lock-comment-face) 27041 27043 (fontified t face font-lock-comment-delimiter-face) 27043 27055 (fontified t face font-lock-comment-face) 27059 27069 (fontified t face font-lock-comment-face) 27069 27071 (fontified t face font-lock-comment-delimiter-face) 27071 27079 (fontified t face font-lock-comment-face) 27083 27093 (fontified t face font-lock-comment-face) 27093 27094 (fontified t) 27094 27101 (fontified t face font-lock-comment-delimiter-face) 27101 27102 (fontified t face font-lock-comment-face) 27102 27103 (fontified t face font-lock-comment-delimiter-face) 27103 27109 (fontified t face font-lock-comment-face) 27109 27115 (fontified t face font-lock-comment-delimiter-face) 27115 27116 (fontified t face font-lock-comment-face) 27116 27118 (fontified t face font-lock-comment-delimiter-face) 27118 27121 (fontified t face font-lock-comment-face) 27125 27144 (fontified t face font-lock-comment-face) 27148 27161 (fontified t face font-lock-comment-face) 27165 27184 (fontified t face font-lock-comment-face) 27184 27186 (fontified t face font-lock-comment-delimiter-face) 27186 27224 (fontified t face font-lock-comment-face) 27224 27226 (fontified t face font-lock-comment-delimiter-face) 27226 27236 (fontified t face font-lock-comment-face) 27240 27252 (fontified t face font-lock-comment-face) 27252 27254 (fontified t face font-lock-comment-delimiter-face) 27254 27264 (fontified t face font-lock-comment-face) 27268 27280 (fontified t face font-lock-comment-face) 27280 27282 (fontified t face font-lock-comment-delimiter-face) 27282 27305 (fontified t face font-lock-comment-face) 27309 27314 (fontified t face font-lock-comment-face) 27318 27360 (fontified t face font-lock-comment-face) 27360 27362 (fontified t face font-lock-comment-delimiter-face) 27362 27416 (fontified t face font-lock-comment-face) 27416 27418 (fontified t face font-lock-comment-delimiter-face) 27418 27463 (fontified t face font-lock-comment-face) 27463 27465 (fontified t face font-lock-comment-delimiter-face) 27465 27493 (fontified t face font-lock-comment-face) 27493 27494 (fontified t) 27494 27495 (fontified t face font-lock-comment-delimiter-face) 27495 27515 (fontified t face font-lock-comment-face) 27515 27516 (fontified t face font-lock-comment-delimiter-face) 27516 27534 (fontified t face font-lock-comment-face) 27534 27541 (fontified t) 27541 27543 (fontified t face font-lock-constant-face) 27543 27547 (fontified t) 27551 27591 (fontified t) 27591 27595 (fontified t face font-lock-type-face) 27595 27657 (fontified t) 27657 27658 (fontified t face font-lock-comment-delimiter-face) 27658 27762 (fontified t face font-lock-comment-face) 27766 27773 (fontified t face font-lock-comment-face) 27773 27774 (fontified t face font-lock-comment-delimiter-face) 27774 27794 (fontified t face font-lock-comment-face) 27794 27812 (fontified t) 27812 27894 (fontified t face font-lock-string-face) 27898 27908 (fontified t face font-lock-string-face) 27908 27910 (fontified t) 27910 27968 (fontified t) 27968 28011 (fontified t) 28011 28022 (fontified t face font-lock-string-face) 28022 28031 (fontified t) 28031 28041 (fontified t face font-lock-string-face) 28041 28071 (fontified t) 28071 28099 (fontified t face font-lock-string-face) 28099 28146 (fontified t) 28146 28169 (fontified t face font-lock-string-face) 28169 28171 (fontified t) 28171 28183 (fontified t) 28183 28267 (fontified t face font-lock-string-face) 28271 28279 (fontified t face font-lock-string-face) 28279 28281 (fontified t) 28281 28297 (fontified t) 28297 28301 (fontified t face font-lock-type-face) 28301 28312 (fontified t) 28313 28328 (fontified t face font-lock-comment-delimiter-face) 28328 28329 (fontified t face font-lock-comment-face) 28329 28330 (fontified t face font-lock-comment-delimiter-face) 28330 28335 (fontified t face font-lock-comment-face) 28335 28350 (fontified t face font-lock-comment-delimiter-face) 28350 28351 (fontified t face font-lock-comment-face) 28351 28358 (fontified t face font-lock-constant-face) 28358 28365 (fontified t) 28365 28372 (fontified t face font-lock-constant-face) 28372 28382 (fontified t) 28382 28389 (fontified t face font-lock-constant-face) 28389 28400 (fontified t) 28400 28407 (fontified t face font-lock-constant-face) 28407 28417 (fontified t) 28417 28424 (fontified t face font-lock-constant-face) 28424 28431 (fontified t) 28431 28438 (fontified t face font-lock-constant-face) 28438 28451 (fontified t) 28451 28458 (fontified t face font-lock-constant-face) 28458 28469 (fontified t) 28469 28476 (fontified t face font-lock-constant-face) 28476 28484 (fontified t) 28484 28491 (fontified t face font-lock-constant-face) 28491 28498 (fontified t) 28498 28505 (fontified t face font-lock-constant-face) 28505 28513 (fontified t) 28513 28520 (fontified t face font-lock-constant-face) 28520 28526 (fontified t) 28526 28533 (fontified t face font-lock-constant-face) 28533 28541 (fontified t) 28541 28548 (fontified t face font-lock-constant-face) 28548 28556 (fontified t) 28556 28563 (fontified t face font-lock-constant-face) 28563 28571 (fontified t) 28571 28578 (fontified t face font-lock-constant-face) 28578 28588 (fontified t) 28588 28589 (fontified t face font-lock-comment-delimiter-face) 28589 28598 (fontified t face font-lock-comment-face) 28598 28604 (fontified t face font-lock-constant-face) 28604 28605 (fontified t) 28605 28669 (fontified t face font-lock-string-face) 28669 28671 (fontified t) 28671 28677 (fontified t face font-lock-constant-face) 28677 28678 (fontified t) 28678 28738 (fontified t face font-lock-string-face) 28738 28742 (fontified t) 28742 28743 (fontified t face font-lock-comment-delimiter-face) 28743 28776 (fontified t face font-lock-comment-face) 28776 28780 (fontified t) 28780 28782 (fontified t face font-lock-constant-face) 28782 28811 (fontified t) 28811 28813 (fontified t face font-lock-constant-face) 28813 28830 (fontified t) 28830 28844 (fontified t) 28844 28846 (fontified t face font-lock-constant-face) 28846 28860 (fontified t) 28860 28866 (fontified t face font-lock-string-face) 28866 28878 (fontified t) 28878 28885 (fontified t face font-lock-string-face) 28885 28886 (fontified t) 28886 28893 (fontified t face font-lock-string-face) 28893 28894 (fontified t) 28894 28903 (fontified t face font-lock-string-face) 28903 28904 (fontified t) 28904 28913 (fontified t face font-lock-string-face) 28913 28914 (fontified t) 28914 28923 (fontified t face font-lock-string-face) 28923 28924 (fontified t) 28924 28925 (fontified t face font-lock-comment-delimiter-face) 28925 28936 (fontified t face font-lock-comment-face) 28936 28947 (fontified t) 28947 28956 (fontified t face font-lock-string-face) 28956 28957 (fontified t) 28957 28965 (fontified t face font-lock-string-face) 28965 28966 (fontified t) 28966 28977 (fontified t face font-lock-string-face) 28977 28978 (fontified t) 28978 28986 (fontified t face font-lock-string-face) 28986 28987 (fontified t) 28987 28998 (fontified t face font-lock-string-face) 28998 28999 (fontified t) 28999 29008 (fontified t face font-lock-string-face) 29008 29009 (fontified t) 29009 29020 (fontified t face font-lock-string-face) 29020 29021 (fontified t) 29021 29032 (fontified t face font-lock-string-face) 29032 29033 (fontified t) 29033 29044 (fontified t face font-lock-string-face) 29044 29045 (fontified t) 29045 29046 (fontified t face font-lock-comment-delimiter-face) 29046 29054 (fontified t face font-lock-comment-face) 29054 29065 (fontified t) 29065 29078 (fontified t face font-lock-string-face) 29078 29079 (fontified t) 29079 29091 (fontified t face font-lock-string-face) 29091 29092 (fontified t) 29092 29107 (fontified t face font-lock-string-face) 29107 29108 (fontified t) 29108 29120 (fontified t face font-lock-string-face) 29120 29121 (fontified t) 29121 29136 (fontified t face font-lock-string-face) 29136 29137 (fontified t) 29137 29150 (fontified t face font-lock-string-face) 29150 29151 (fontified t) 29151 29166 (fontified t face font-lock-string-face) 29166 29167 (fontified t) 29167 29182 (fontified t face font-lock-string-face) 29182 29183 (fontified t) 29183 29198 (fontified t face font-lock-string-face) 29198 29199 (fontified t face font-lock-comment-delimiter-face) 29199 29206 (fontified t face font-lock-comment-face) 29206 29217 (fontified t) 29217 29226 (fontified t face font-lock-string-face) 29226 29227 (fontified t) 29227 29228 (fontified t face font-lock-comment-delimiter-face) 29228 29233 (fontified t face font-lock-comment-face) 29233 29244 (fontified t) 29244 29252 (fontified t face font-lock-string-face) 29252 29253 (fontified t) 29253 29261 (fontified t face font-lock-string-face) 29261 29262 (fontified t) 29262 29263 (fontified t face font-lock-comment-delimiter-face) 29263 29274 (fontified t face font-lock-comment-face) 29274 29285 (fontified t) 29285 29299 (fontified t face font-lock-string-face) 29299 29300 (fontified t) 29300 29310 (fontified t face font-lock-string-face) 29310 29322 (fontified t) 29322 29335 (fontified t face font-lock-string-face) 29335 29336 (fontified t) 29336 29348 (fontified t face font-lock-string-face) 29348 29349 (fontified t) 29349 29364 (fontified t face font-lock-string-face) 29364 29365 (fontified t) 29365 29377 (fontified t face font-lock-string-face) 29377 29378 (fontified t) 29378 29389 (fontified t) 29389 29403 (fontified t face font-lock-string-face) 29403 29404 (fontified t) 29404 29419 (fontified t face font-lock-string-face) 29419 29420 (fontified t) 29420 29440 (fontified t face font-lock-string-face) 29440 29452 (fontified t) 29452 29472 (fontified t face font-lock-string-face) 29472 29473 (fontified t) 29473 29486 (fontified t face font-lock-string-face) 29486 29487 (fontified t) 29487 29503 (fontified t face font-lock-string-face) 29503 29504 (fontified t) 29504 29519 (fontified t face font-lock-string-face) 29519 29540 (fontified t) 29540 29558 (fontified t face font-lock-string-face) 29558 29559 (fontified t) 29559 29574 (fontified t face font-lock-string-face) 29574 29575 (fontified t) 29575 29592 (fontified t face font-lock-string-face) 29592 29593 (fontified t) 29593 29611 (fontified t face font-lock-string-face) 29611 29612 (fontified t) 29612 29635 (fontified t face font-lock-string-face) 29635 29666 (fontified t) 29666 29668 (fontified t face font-lock-constant-face) 29668 29687 (fontified t) 29687 29691 (fontified t face font-lock-comment-delimiter-face) 29691 29703 (fontified t face font-lock-comment-face) 29703 29706 (fontified t) 29710 29711 (fontified t) 29711 29713 (fontified t face font-lock-constant-face) 29713 29721 (fontified t) 29721 29808 (fontified t face font-lock-string-face) 29812 29817 (fontified t face font-lock-string-face) 29817 29819 (fontified t) 29819 29820 (fontified t) 29820 29824 (face font-lock-comment-delimiter-face) 29824 29873 (face font-lock-comment-face) 29880 29882 (face font-lock-constant-face) 29907 29912 (face font-lock-string-face) 29937 29955 (face font-lock-comment-delimiter-face) 29955 30003 (face font-lock-comment-face) 30009 30011 (face font-lock-constant-face) 30030 30035 (face font-lock-string-face) 30045 30053 (face font-lock-keyword-face) 30072 30074 (face font-lock-constant-face) 30229 30231 (face font-lock-constant-face) 30255 30257 (face font-lock-constant-face) 30302 30305 (face font-lock-string-face) 30308 30325 (face font-lock-comment-delimiter-face) 30325 30333 (face font-lock-comment-face) 30365 30368 (face font-lock-string-face) 30371 30375 (face font-lock-comment-delimiter-face) 30375 30397 (face font-lock-comment-face) 30405 30407 (face font-lock-constant-face) 30433 30435 (face font-lock-keyword-face) 30453 30454 (face font-lock-comment-delimiter-face) 30454 30475 (face font-lock-comment-face) 30486 30488 (face font-lock-constant-face) 30524 30526 (face font-lock-constant-face) 30576 30578 (face font-lock-constant-face) 30629 30630 (face font-lock-comment-delimiter-face) 30630 30635 (face font-lock-comment-face) 30635 30636 (face font-lock-comment-delimiter-face) 30636 30655 (face font-lock-comment-face) 30663 30665 (face font-lock-constant-face) 31361 31363 (face font-lock-constant-face) 31454 31455 (face font-lock-comment-delimiter-face) 31455 31464 (face font-lock-comment-face) 31529 31530 (face font-lock-comment-delimiter-face) 31530 31538 (face font-lock-comment-face) 40207 40210 (fontified t) 40214 40241 (fontified t) 40245 40278 (fontified t) 40282 40321 (fontified t) 40325 40362 (fontified t) 40366 40403 (fontified t) 40407 40434 (fontified t) 40438 40471 (fontified t) 40475 40504 (fontified t) 40508 40537 (fontified t) 40541 40572 (fontified t) 40576 40605 (fontified t) 40609 40638 (fontified t) 40642 40669 (fontified t) 40673 40700 (fontified t) 40704 40724 (fontified t) 40724 40727 (fontified t) 40731 40754 (fontified t) 40758 40781 (fontified t) 40785 40810 (fontified t) 40810 40811 (fontified t face font-lock-comment-delimiter-face) 40811 40832 (fontified t face font-lock-comment-face) 40832 40835 (fontified t) 40839 40875 (fontified t) 40879 40891 (fontified t) 40895 40913 (fontified t) 40913 40917 (fontified t face font-lock-type-face) 40917 40926 (fontified t) 40926 40930 (fontified t face font-lock-type-face) 40930 40945 (fontified t) 40949 40959 (fontified t) 40959 40960 (fontified t face font-lock-comment-delimiter-face) 40960 40986 (fontified t face font-lock-comment-face) 40986 40989 (fontified t) 40993 40994 (fontified t) 40994 40996 (fontified t face font-lock-constant-face) 40996 41000 (fontified t) 41004 41039 (fontified t) 41043 41044 (fontified t) 41044 41046 (fontified t face font-lock-constant-face) 41046 41050 (fontified t) 41054 41087 (fontified t) 41091 41092 (fontified t) 41092 41179 (fontified t face font-lock-string-face) 41183 41188 (fontified t face font-lock-string-face) 41188 41191 (fontified t) 41191 41192 (fontified t face font-lock-comment-delimiter-face) 41192 41197 (fontified t face font-lock-comment-face) 41197 41199 (fontified t face font-lock-comment-delimiter-face) 41199 41211 (fontified t face font-lock-comment-face) 41215 41225 (fontified t face font-lock-comment-face) 41225 41227 (fontified t face font-lock-comment-delimiter-face) 41227 41235 (fontified t face font-lock-comment-face) 41239 41249 (fontified t face font-lock-comment-face) 41249 41250 (fontified t) 41250 41257 (fontified t face font-lock-comment-delimiter-face) 41257 41258 (fontified t face font-lock-comment-face) 41258 41259 (fontified t face font-lock-comment-delimiter-face) 41259 41265 (fontified t face font-lock-comment-face) 41265 41271 (fontified t face font-lock-comment-delimiter-face) 41271 41272 (fontified t face font-lock-comment-face) 41272 41274 (fontified t face font-lock-comment-delimiter-face) 41274 41277 (fontified t face font-lock-comment-face) 41281 41300 (fontified t face font-lock-comment-face) 41304 41317 (fontified t face font-lock-comment-face) 41321 41340 (fontified t face font-lock-comment-face) 41340 41342 (fontified t face font-lock-comment-delimiter-face) 41342 41380 (fontified t face font-lock-comment-face) 41380 41382 (fontified t face font-lock-comment-delimiter-face) 41382 41392 (fontified t face font-lock-comment-face) 41396 41408 (fontified t face font-lock-comment-face) 41408 41410 (fontified t face font-lock-comment-delimiter-face) 41410 41420 (fontified t face font-lock-comment-face) 41424 41436 (fontified t face font-lock-comment-face) 41436 41438 (fontified t face font-lock-comment-delimiter-face) 41438 41461 (fontified t face font-lock-comment-face) 41465 41470 (fontified t face font-lock-comment-face) 41474 41516 (fontified t face font-lock-comment-face) 41516 41518 (fontified t face font-lock-comment-delimiter-face) 41518 41572 (fontified t face font-lock-comment-face) 41572 41574 (fontified t face font-lock-comment-delimiter-face) 41574 41619 (fontified t face font-lock-comment-face) 41619 41621 (fontified t face font-lock-comment-delimiter-face) 41621 41649 (fontified t face font-lock-comment-face) 41649 41650 (fontified t) 41650 41651 (fontified t face font-lock-comment-delimiter-face) 41651 41671 (fontified t face font-lock-comment-face) 41671 41672 (fontified t face font-lock-comment-delimiter-face) 41672 41690 (fontified t face font-lock-comment-face) 41690 41697 (fontified t) 41697 41699 (fontified t face font-lock-constant-face) 41699 41703 (fontified t) 41707 41747 (fontified t) 41747 41751 (fontified t face font-lock-type-face) 41751 41813 (fontified t) 41813 41814 (fontified t face font-lock-comment-delimiter-face) 41814 41918 (fontified t face font-lock-comment-face) 41922 41929 (fontified t face font-lock-comment-face) 41929 41930 (fontified t face font-lock-comment-delimiter-face) 41930 41950 (fontified t face font-lock-comment-face) 41950 41968 (fontified t) 41968 42050 (fontified t face font-lock-string-face) 42054 42064 (fontified t face font-lock-string-face) 42064 42066 (fontified t) 42066 42124 (fontified t) 42124 42167 (fontified t) 42167 42178 (fontified t face font-lock-string-face) 42178 42187 (fontified t) 42187 42197 (fontified t face font-lock-string-face) 42197 42227 (fontified t) 42227 42255 (fontified t face font-lock-string-face) 42255 42302 (fontified t) 42302 42325 (fontified t face font-lock-string-face) 42325 42327 (fontified t) 42327 42339 (fontified t) 42339 42423 (fontified t face font-lock-string-face) 42427 42435 (fontified t face font-lock-string-face) 42435 42437 (fontified t) 42437 42453 (fontified t) 42453 42457 (fontified t face font-lock-type-face) 42457 42468 (fontified t)) . -1) (undo-tree-id2 . -41225) (undo-tree-id3 . -42467) (undo-tree-id4 . -42468) (undo-tree-id5 . -42467) (undo-tree-id6 . 1) (undo-tree-id7 . -41225)) nil (21640 24092 234766 222000) 0 nil]) ((1 . 184029) (t . 0)) nil (21640 24092 234770 906000) 0 nil]) nil nil (21640 24092 234772 799000) 0 nil] #1# 42565 3 nil]